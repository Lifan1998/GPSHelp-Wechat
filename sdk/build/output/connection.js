var parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"+UWv":[function(require,module,exports) {
var e=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,r=new RegExp("[\\-\\.0-9"+e.source.slice(1,-1)+"·̀-ͯ\\u203F-⁀]"),t=new RegExp("^"+e.source+r.source+"*(?::"+e.source+r.source+"*)?$"),a=0,n=1,i=2,s=3,c=4,u=5,o=6,l=7;function f(){}function d(e,r,t,a,n){function i(e){var r=e.slice(1,-1);return r in t?t[r]:"#"===r.charAt(0)?function(e){if(e>65535){var r=55296+((e-=65536)>>10),t=56320+(1023&e);return String.fromCharCode(r,t)}return String.fromCharCode(e)}(parseInt(r.substr(1).replace("x","0x"))):(n.error("entity not found:"+e),e)}function s(r){if(r>F){var t=e.substring(F,r).replace(/&#?\w+;/g,i);f&&c(F),a.characters(t,0,r-F),F=r}}function c(r,t){for(;r>=o&&(t=l.exec(e));)u=t.index,o=u+t[0].length,f.lineNumber++;f.columnNumber=r-u+1}for(var u=0,o=0,l=/.+(?:\r\n?|\n)|.*$/g,f=a.locator,d=[{currentNSMap:r}],b={},F=0;;){try{var D=e.indexOf("<",F);if(D<0){if(!e.substr(F).match(/^\s*$/)){var E=a.document,k=E.createTextNode(e.substr(F));E.appendChild(k),a.currentElement=k}return}switch(D>F&&s(D),e.charAt(D+1)){case"/":var A=e.indexOf(">",D+3),C=e.substring(D+2,A),M=d.pop(),O=M.localNSMap;if(M.tagName!=C&&n.fatalError("end tag name: "+C+" is not match the current start tagName:"+M.tagName),a.endElement(M.uri,M.localName,C),O)for(var $ in O)a.endPrefixMapping($);A++;break;case"?":f&&c(D),A=v(e,D,a);break;case"!":f&&c(D),A=x(e,D,a,n);break;default:f&&c(D);var T=new N,q=(A=h(e,D,T,i,n),T.length);if(f){if(q)for(var S=0;S<q;S++){var y=T[S];c(y.offset),y.offset=m(f,{})}c(A)}!T.closed&&w(e,A,T.tagName,b)&&(T.closed=!0,t.nbsp||n.warning("unclosed xml attribute")),g(T,a,d),"http://www.w3.org/1999/xhtml"!==T.uri||T.closed?A++:A=p(e,A,T.tagName,i,a)}}catch(I){n.error("element parse error: "+I),A=-1}A>F?F=A:s(Math.max(D,F)+1)}}function m(e,r){return r.lineNumber=e.lineNumber,r.columnNumber=e.columnNumber,r}function h(e,r,t,f,d){for(var m,h=++r,g=a;;){var p=e.charAt(h);switch(p){case"=":if(g===n)m=e.slice(r,h),g=s;else{if(g!==i)throw new Error("attribute equal must after attrName");g=s}break;case"'":case'"':if(g===s){if(r=h+1,!((h=e.indexOf(p,r))>0))throw new Error("attribute value no end '"+p+"' match");w=e.slice(r,h).replace(/&#?\w+;/g,f),t.add(m,w,r-1),g=u}else{if(g!=c)throw new Error('attribute value must after "="');w=e.slice(r,h).replace(/&#?\w+;/g,f),t.add(m,w,r),d.warning('attribute "'+m+'" missed start quot('+p+")!!"),r=h+1,g=u}break;case"/":switch(g){case a:t.setTagName(e.slice(r,h));case u:case o:case l:g=l,t.closed=!0;case c:case n:case i:break;default:throw new Error("attribute invalid close char('/')")}break;case"":d.error("unexpected end of input");case">":switch(g){case a:t.setTagName(e.slice(r,h));case u:case o:case l:break;case c:case n:"/"===(w=e.slice(r,h)).slice(-1)&&(t.closed=!0,w=w.slice(0,-1));case i:g===i&&(w=m),g==c?(d.warning('attribute "'+w+'" missed quot(")!!'),t.add(m,w.replace(/&#?\w+;/g,f),r)):(d.warning('attribute "'+w+'" missed value!! "'+w+'" instead!!'),t.add(w,w,r));break;case s:throw new Error("attribute value missed!!")}return h;case"":p=" ";default:if(p<=" ")switch(g){case a:t.setTagName(e.slice(r,h)),g=o;break;case n:m=e.slice(r,h),g=i;break;case c:var w=e.slice(r,h).replace(/&#?\w+;/g,f);d.warning('attribute "'+w+'" missed quot(")!!'),t.add(m,w,r);case u:g=o}else switch(g){case i:d.warning('attribute "'+m+'" missed value!! "'+m+'" instead!!'),t.add(m,m,r),r=h,g=n;break;case u:d.warning('attribute space is required"'+m+'"!!');case o:g=n,r=h;break;case s:g=c,r=h;break;case l:throw new Error("elements closed character '/' and '>' must be connected to")}}h++}}function g(e,r,t){for(var a=e.tagName,n=null,i=t[t.length-1].currentNSMap,s=e.length;s--;){var c=e[s],u=c.qName,o=c.value;if((m=u.indexOf(":"))>0)var l=c.prefix=u.slice(0,m),f=u.slice(m+1),d="xmlns"===l&&f;else f=u,l=null,d="xmlns"===u&&"";c.localName=f,!1!==d&&(null==n&&(n={},b(i,i={})),i[d]=n[d]=o,c.uri="http://www.w3.org/2000/xmlns/",r.startPrefixMapping(d,o))}for(s=e.length;s--;){(l=(c=e[s]).prefix)&&("xml"===l&&(c.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==l&&(c.uri=i[l]))}var m;(m=a.indexOf(":"))>0?(l=e.prefix=a.slice(0,m),f=e.localName=a.slice(m+1)):(l=null,f=e.localName=a);var h=e.uri=i[l||""];if(r.startElement(h,f,a,e),e.closed){if(r.endElement(h,f,a),n)for(l in n)r.endPrefixMapping(l)}else e.currentNSMap=i,e.localNSMap=n,t.push(e)}function p(e,r,t,a,n){if(/^(?:script|textarea)$/i.test(t)){var i=e.indexOf("</"+t+">",r),s=e.substring(r+1,i);if(/[&<]/.test(s))return/^script$/i.test(t)?(n.characters(s,0,s.length),i):(s=s.replace(/&#?\w+;/g,a),n.characters(s,0,s.length),i)}return r+1}function w(e,r,t,a){var n=a[t];return null==n&&(n=a[t]=e.lastIndexOf("</"+t+">")),n<r}function b(e,r){for(var t in e)r[t]=e[t]}function x(e,r,t,a){switch(e.charAt(r+2)){case"-":return"-"===e.charAt(r+3)?(n=e.indexOf("--\x3e",r+4))>r?(t.comment(e,r+4,n-r-4),n+3):(a.error("Unclosed comment"),-1):-1;default:if("CDATA["==e.substr(r+3,6)){var n=e.indexOf("]]>",r+9);return t.startCDATA(),t.characters(e,r+9,n-r-9),t.endCDATA(),n+3}var i=D(e,r),s=i.length;if(s>1&&/!doctype/i.test(i[0][0])){var c=i[1][0],u=s>3&&/^public$/i.test(i[2][0])&&i[3][0],o=s>4&&i[4][0],l=i[s-1];return t.startDTD(c,u&&u.replace(/^(['"])(.*?)\1$/,"$2"),o&&o.replace(/^(['"])(.*?)\1$/,"$2")),t.endDTD(),l.index+l[0].length}}return-1}function v(e,r,t){var a=e.indexOf("?>",r);if(a){var n=e.substring(r,a).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(n){n[0].length;return t.processingInstruction(n[1],n[2]),a+2}return-1}return-1}function N(e){}function F(e,r){return e.__proto__=r,e}function D(e,r){var t,a=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(n.lastIndex=r,n.exec(e);t=n.exec(e);)if(a.push(t),t[1])return a}f.prototype={parse:function(e,r,t){var a=this.domBuilder;a.startDocument(),b(r,r={}),d(e,r,t,a,this.errorHandler),a.endDocument()}},N.prototype={setTagName:function(e){if(!t.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,r,a){if(!t.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:r,offset:a}},length:0,getLocalName:function(e){return this[e].localName},getOffset:function(e){return this[e].offset},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},F({},F.prototype)instanceof F||(F=function(e,r){function t(){}for(r in t.prototype=r,t=new t,e)t[r]=e[r];return t}),"function"==typeof require&&(exports.XMLReader=f);
},{}],"Vlka":[function(require,module,exports) {
function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){for(var n in e)t[n]=e[n]}function n(e,n){var r=e.prototype;if(Object.create){var i=Object.create(n.prototype);r.__proto__=i}if(!(r instanceof n)){var o=function(){};o.prototype=n.prototype,t(r,o=new o),e.prototype=r=o}r.constructor!=e&&(r.constructor=e)}var r="http://www.w3.org/1999/xhtml",i={},o=i.ELEMENT_NODE=1,a=i.ATTRIBUTE_NODE=2,u=i.TEXT_NODE=3,s=i.CDATA_SECTION_NODE=4,l=i.ENTITY_REFERENCE_NODE=5,c=i.ENTITY_NODE=6,h=i.PROCESSING_INSTRUCTION_NODE=7,d=i.COMMENT_NODE=8,p=i.DOCUMENT_NODE=9,f=i.DOCUMENT_TYPE_NODE=10,m=i.DOCUMENT_FRAGMENT_NODE=11,N=i.NOTATION_NODE=12,g={},v={},E=g.INDEX_SIZE_ERR=(v[1]="Index size error",1),y=g.DOMSTRING_SIZE_ERR=(v[2]="DOMString size error",2),w=g.HIERARCHY_REQUEST_ERR=(v[3]="Hierarchy request error",3),b=g.WRONG_DOCUMENT_ERR=(v[4]="Wrong document",4),T=g.INVALID_CHARACTER_ERR=(v[5]="Invalid character",5),S=g.NO_DATA_ALLOWED_ERR=(v[6]="No data allowed",6),_=g.NO_MODIFICATION_ALLOWED_ERR=(v[7]="No modification allowed",7),D=g.NOT_FOUND_ERR=(v[8]="Not found",8),C=g.NOT_SUPPORTED_ERR=(v[9]="Not supported",9),I=g.INUSE_ATTRIBUTE_ERR=(v[10]="Attribute in use",10),A=g.INVALID_STATE_ERR=(v[11]="Invalid state",11),R=g.SYNTAX_ERR=(v[12]="Syntax error",12),O=g.INVALID_MODIFICATION_ERR=(v[13]="Invalid modification",13),x=g.NAMESPACE_ERR=(v[14]="Invalid namespace",14),U=g.INVALID_ACCESS_ERR=(v[15]="Invalid access",15);function M(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,v[e]),this.message=v[e],Error.captureStackTrace&&Error.captureStackTrace(this,M);return n.code=e,t&&(this.message=this.message+": "+t),n}function B(){}function P(e,t){this._node=e,this._refresh=t,V(this)}function V(e){var n=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=n){var r=e._refresh(e._node);me(e,"length",r.length),t(r,e),e._inc=n}}function L(){}function j(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function k(e,t,n,r){if(r?t[j(t,r)]=n:t[t.length++]=n,e){n.ownerElement=e;var i=e.ownerDocument;i&&(r&&X(i,e,r),W(i,e,n))}}function F(e,t,n){var r=j(t,n);if(!(r>=0))throw M(D,new Error);for(var i=t.length-1;r<i;)t[r]=t[++r];if(t.length=i,e){var o=e.ownerDocument;o&&(X(o,e,n),n.ownerElement=null)}}function Y(e){if(this._features={},e)for(var t in e)this._features=e[t]}function z(){}function $(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function G(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(G(e,t))return!0}while(e=e.nextSibling)}function H(){}function W(e,t,n){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&(t._nsMap[n.prefix?n.localName:""]=n.value)}function X(e,t,n,r){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&delete t._nsMap[n.prefix?n.localName:""]}function q(e,t,n){if(e&&e._inc){e._inc++;var r=t.childNodes;if(n)r[r.length++]=n;else{for(var i=t.firstChild,o=0;i;)r[o++]=i,i=i.nextSibling;r.length=o}}}function Z(e,t){var n=t.previousSibling,r=t.nextSibling;return n?n.nextSibling=r:e.firstChild=r,r?r.previousSibling=n:e.lastChild=n,q(e.ownerDocument,e),t}function Q(e,t,n){var r=t.parentNode;if(r&&r.removeChild(t),t.nodeType===m){var i=t.firstChild;if(null==i)return t;var o=t.lastChild}else i=o=t;var a=n?n.previousSibling:e.lastChild;i.previousSibling=a,o.nextSibling=n,a?a.nextSibling=i:e.firstChild=i,null==n?e.lastChild=o:n.previousSibling=o;do{i.parentNode=e}while(i!==o&&(i=i.nextSibling));return q(e.ownerDocument||e,e),t.nodeType==m&&(t.firstChild=t.lastChild=null),t}function J(e,t){var n=t.parentNode;if(n){var r=e.lastChild;n.removeChild(t);r=e.lastChild}r=e.lastChild;return t.parentNode=e,t.previousSibling=r,t.nextSibling=null,r?r.nextSibling=t:e.firstChild=t,e.lastChild=t,q(e.ownerDocument,e,t),t}function K(){this._nsMap={}}function ee(){}function te(){}function ne(){}function re(){}function ie(){}function oe(){}function ae(){}function ue(){}function se(){}function le(){}function ce(){}function he(){}function de(e,t,n,i){switch(e.nodeType){case o:var c=e.attributes,N=c.length,g=e.firstChild,v=e.tagName;i=r===e.namespaceURI||i,t.push("<",v),n&&t.sort.apply(c,n);for(var E=0;E<N;E++)de(c.item(E),t,n,i);if(g||i&&!/^(?:meta|link|img|br|hr|input|button)$/i.test(v)){if(t.push(">"),i&&/^script$/i.test(v))g&&t.push(g.data);else for(;g;)de(g,t,n,i),g=g.nextSibling;t.push("</",v,">")}else t.push("/>");return;case p:case m:for(g=e.firstChild;g;)de(g,t,n,i),g=g.nextSibling;return;case a:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,$),'"');case u:return t.push(e.data.replace(/[<&]/g,$));case s:return t.push("<![CDATA[",e.data,"]]>");case d:return t.push("\x3c!--",e.data,"--\x3e");case f:var y=e.publicId,w=e.systemId;if(t.push("<!DOCTYPE ",e.name),y)t.push(' PUBLIC "',y),w&&"."!=w&&t.push('" "',w),t.push('">');else if(w&&"."!=w)t.push(' SYSTEM "',w,'">');else{var b=e.internalSubset;b&&t.push(" [",b,"]"),t.push(">")}return;case h:return t.push("<?",e.target," ",e.data,"?>");case l:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function pe(e,t,n){var r;switch(t.nodeType){case o:(r=t.cloneNode(!1)).ownerDocument=e;case m:break;case a:n=!0}if(r||(r=t.cloneNode(!1)),r.ownerDocument=e,r.parentNode=null,n)for(var i=t.firstChild;i;)r.appendChild(pe(e,i,n)),i=i.nextSibling;return r}function fe(t,n,r){var i=new n.constructor;for(var u in n){var s=n[u];"object"!=e(s)&&s!=i[u]&&(i[u]=s)}switch(n.childNodes&&(i.childNodes=new B),i.ownerDocument=t,i.nodeType){case o:var l=n.attributes,c=i.attributes=new L,h=l.length;c._ownerElement=i;for(var d=0;d<h;d++)i.setAttributeNode(fe(t,l.item(d),!0));break;case a:r=!0}if(r)for(var p=n.firstChild;p;)i.appendChild(fe(t,p,r)),p=p.nextSibling;return i}function me(e,t,n){e[t]=n}M.prototype=Error.prototype,t(g,M),B.prototype={length:0,item:function(e){return this[e]||null},toString:function(){for(var e=[],t=0;t<this.length;t++)de(this[t],e);return e.join("")}},P.prototype.item=function(e){return V(this),this[e]},n(P,B),L.prototype={length:0,item:B.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new M(I);var n=this.getNamedItem(e.nodeName);return k(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new M(I);return t=this.getNamedItemNS(e.namespaceURI,e.localName),k(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return F(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return F(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var r=this[n];if(r.localName==t&&r.namespaceURI==e)return r}return null}},Y.prototype={hasFeature:function(e,t){var n=this._features[e.toLowerCase()];return!(!n||t&&!(t in n))},createDocument:function(e,t,n){var r=new H;if(r.implementation=this,r.childNodes=new B,r.doctype=n,n&&r.appendChild(n),t){var i=r.createElementNS(e,t);r.appendChild(i)}return r},createDocumentType:function(e,t,n){var r=new oe;return r.name=e,r.nodeName=e,r.publicId=t,r.systemId=n,r}},z.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return Q(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return Z(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return fe(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==u&&e.nodeType==u?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var r in n)if(n[r]==e)return r;t=2==t.nodeType?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&e in n)return n[e];t=2==t.nodeType?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},t(i,z),t(i,z.prototype),H.prototype={nodeName:"#document",nodeType:p,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==m){for(var n=e.firstChild;n;){var r=n.nextSibling;this.insertBefore(n,t),n=r}return e}return null==this.documentElement&&1==e.nodeType&&(this.documentElement=e),Q(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),Z(this,e)},importNode:function(e,t){return pe(this,e,t)},getElementById:function(e){var t=null;return G(this.documentElement,function(n){if(1==n.nodeType&&n.getAttribute("id")==e)return t=n,!0}),t},createElement:function(e){var t=new K;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new B,(t.attributes=new L)._ownerElement=t,t},createDocumentFragment:function(){var e=new le;return e.ownerDocument=this,e.childNodes=new B,e},createTextNode:function(e){var t=new ne;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new re;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new ie;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new ce;return n.ownerDocument=this,n.tagName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new ee;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new se;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new K,r=t.split(":"),i=n.attributes=new L;return n.childNodes=new B,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,i._ownerElement=n,n},createAttributeNS:function(e,t){var n=new ee,r=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,n}},n(H,z),K.prototype={nodeType:o,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===m?this.insertBefore(e,null):J(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var r=this.ownerDocument.createAttributeNS(e,t);r.value=r.nodeValue=""+n,this.setAttributeNode(r)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new P(this,function(t){var n=[];return G(t,function(r){r===t||r.nodeType!=o||"*"!==e&&r.tagName!=e||n.push(r)}),n})},getElementsByTagNameNS:function(e,t){return new P(this,function(n){var r=[];return G(n,function(i){i===n||i.nodeType!==o||"*"!==e&&i.namespaceURI!==e||"*"!==t&&i.localName!=t||r.push(i)}),r})}},H.prototype.getElementsByTagName=K.prototype.getElementsByTagName,H.prototype.getElementsByTagNameNS=K.prototype.getElementsByTagNameNS,n(K,z),ee.prototype.nodeType=a,n(ee,z),te.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(v[3])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){n=this.data.substring(0,e)+n+this.data.substring(e+t),this.nodeValue=this.data=n,this.length=n.length}},n(te,z),ne.prototype={nodeName:"#text",nodeType:u,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var r=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling),r}},n(ne,te),re.prototype={nodeName:"#comment",nodeType:d},n(re,te),ie.prototype={nodeName:"#cdata-section",nodeType:s},n(ie,te),oe.prototype.nodeType=f,n(oe,z),ae.prototype.nodeType=N,n(ae,z),ue.prototype.nodeType=c,n(ue,z),se.prototype.nodeType=l,n(se,z),le.prototype.nodeName="#document-fragment",le.prototype.nodeType=m,n(le,z),ce.prototype.nodeType=h,n(ce,z),he.prototype.serializeToString=function(e,t){return e.toString(t)},z.prototype.toString=function(e){var t=[];return de(this,t,e),t.join("")};try{if(Object.defineProperty){var Ne=function e(t){switch(t.nodeType){case 1:case 11:var n=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&n.push(e(t)),t=t.nextSibling;return n.join("");default:return t.nodeValue}};Object.defineProperty(P.prototype,"length",{get:function(){return V(this),this.$$length}}),Object.defineProperty(z.prototype,"textContent",{get:function(){return Ne(this)},set:function(e){switch(this.nodeType){case 1:case 11:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=value,this.nodeValue=e}}}),me=function(e,t,n){e["$$"+t]=n}}}catch(ge){}"function"==typeof require&&(exports.DOMImplementation=Y,exports.XMLSerializer=he);
},{}],"A2Tl":[function(require,module,exports) {
function t(t){this.options=t||{locator:{}}}function e(t,e,r){if(!t){if(e instanceof n)return e;t=e}var i={},c=t instanceof Function;function a(e){var n=t[e];!n&&c&&(n=2==t.length?function(n){t(e,n)}:t),i[e]=n&&function(t){n("[xmldom "+e+"]\t"+t+o(r))}||function(){}}return r=r||{},a("warning"),a("error"),a("fatalError"),i}function n(){this.cdata=!1}function r(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function o(t){if(t)return"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}function i(t,e,n){return"string"==typeof t?t.substr(e,n):t.length>=e+n||e?new java.lang.String(t,e,n)+"":t}function c(t,e){t.currentElement?t.currentElement.appendChild(e):t.document.appendChild(e)}if(t.prototype.parseFromString=function(t,r){var o=this.options,i=new a,c=o.domBuilder||new n,u=o.errorHandler,l=o.locator,s=o.xmlns||{},m={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return l&&c.setDocumentLocator(l),i.errorHandler=e(u,c,l),i.domBuilder=o.domBuilder||c,/\/x?html?$/.test(r)&&(m.nbsp=" ",m.copy="©",s[""]="http://www.w3.org/1999/xhtml"),s.xml=s.xml||"http://www.w3.org/XML/1998/namespace",t?i.parse(t,s,m):i.errorHandler.error("invalid document source"),c.document},n.prototype={startDocument:function(){this.document=(new u).createDocument(null,null,null),this.locator&&(this.document.documentURI=this.locator.systemId)},startElement:function(t,e,n,o){var i=this.document,a=i.createElementNS(t,n||e),u=o.length;c(this,a),this.currentElement=a,this.locator&&r(this.locator,a);for(var l=0;l<u;l++){t=o.getURI(l);var s=o.getValue(l),m=(n=o.getQName(l),i.createAttributeNS(t,n));m.getOffset&&r(m.getOffset(1),m),m.value=m.nodeValue=s,a.setAttributeNode(m)}},endElement:function(t,e,n){var r=this.currentElement;r.tagName;this.currentElement=r.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var n=this.document.createProcessingInstruction(t,e);this.locator&&r(this.locator,n),c(this,n)},ignorableWhitespace:function(t,e,n){},characters:function(t,e,n){if(t=i.apply(this,arguments),this.currentElement&&t){if(this.cdata){var o=this.document.createCDATASection(t);this.currentElement.appendChild(o)}else{o=this.document.createTextNode(t);this.currentElement.appendChild(o)}this.locator&&r(this.locator,o)}},skippedEntity:function(t){},endDocument:function(){this.document.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,n){t=i.apply(this,arguments);var o=this.document.createComment(t);this.locator&&r(this.locator,o),c(this,o)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,n){var o=this.document.implementation;if(o&&o.createDocumentType){var i=o.createDocumentType(t,e,n);this.locator&&r(this.locator,i),c(this,i)}},warning:function(t){},error:function(t){},fatalError:function(t){throw t}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){n.prototype[t]=function(){return null}}),"function"==typeof require){var a=require("./sax").XMLReader,u=exports.DOMImplementation=require("./dom").DOMImplementation,l=exports.XMLSerializer=require("./dom").XMLSerializer;exports.DOMParser=t;var t={DOMImplementation:u,XMLSerializer:l,DOMParser:t};module.exports=t}
},{"./sax":"+UWv","./dom":"Vlka"}],"MgtB":[function(require,module,exports) {
var define;
var t;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n=!1,s=require("./xmldom/dom-parser"),i=s.DOMParser,r=(new i).parseFromString("<?xml version='1.0'?>\n","text/xml"),o=o||{};o.DOMParser=i;var a=null,h=null,c=null,u=null,l=null;(function(s){var d,_;if(d=this,_=function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(e){var n,s,i,r,o,a,h,c="",u=0;do{r=(n=e.charCodeAt(u++))>>2,o=(3&n)<<4|(s=e.charCodeAt(u++))>>4,a=(15&s)<<2|(i=e.charCodeAt(u++))>>6,h=63&i,isNaN(s)?(o=(3&n)<<4,a=h=64):isNaN(i)&&(h=64),c=c+t.charAt(r)+t.charAt(o)+t.charAt(a)+t.charAt(h)}while(u<e.length);return c},decode:function(e){var n,s,i,r,o,a,h="",c=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{n=t.indexOf(e.charAt(c++))<<2|(r=t.indexOf(e.charAt(c++)))>>4,s=(15&r)<<4|(o=t.indexOf(e.charAt(c++)))>>2,i=(3&o)<<6|(a=t.indexOf(e.charAt(c++))),h+=String.fromCharCode(n),64!=o&&(h+=String.fromCharCode(s)),64!=a&&(h+=String.fromCharCode(i))}while(c<e.length);return h}}},"function"==typeof t&&t.amd?t("strophe-base64",function(){return _()}):d.Base64=_(),function(e,n){"function"==typeof t&&t.amd?t("strophe-sha1",function(){return n()}):e.SHA1=n()}(this,function(){function t(t,s){t[s>>5]|=128<<24-s%32,t[15+(s+64>>9<<4)]=s;var o,a,h,c,u,l,d,_,p=new Array(80),m=1732584193,f=-271733879,g=-1732584194,S=271733878,b=-1009589776;for(o=0;o<t.length;o+=16){for(c=m,u=f,l=g,d=S,_=b,a=0;a<80;a++)p[a]=a<16?t[o+a]:r(p[a-3]^p[a-8]^p[a-14]^p[a-16],1),h=i(i(r(m,5),e(a,f,g,S)),i(i(b,p[a]),n(a))),b=S,S=g,g=r(f,30),f=m,m=h;m=i(m,c),f=i(f,u),g=i(g,l),S=i(S,d),b=i(b,_)}return[m,f,g,S,b]}function e(t,e,n,s){return t<20?e&n|~e&s:t<40?e^n^s:t<60?e&n|e&s|n&s:e^n^s}function n(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function s(e,n){var s=o(e);s.length>16&&(s=t(s,8*e.length));for(var i=new Array(16),r=new Array(16),a=0;a<16;a++)i[a]=909522486^s[a],r[a]=1549556828^s[a];var h=t(i.concat(o(n)),512+8*n.length);return t(r.concat(h),672)}function i(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function r(t,e){return t<<e|t>>>32-e}function o(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<24-n%32;return e}function a(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>24-n%32&255);return e}function h(t){for(var e,n,s="",i=0;i<4*t.length;i+=3)for(e=(t[i>>2]>>8*(3-i%4)&255)<<16|(t[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|t[i+2>>2]>>8*(3-(i+2)%4)&255,n=0;n<4;n++)8*i+6*n>32*t.length?s+="=":s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>6*(3-n)&63);return s}return{b64_hmac_sha1:function(t,e){return h(s(t,e))},b64_sha1:function(e){return h(t(o(e),8*e.length))},binb2str:a,core_hmac_sha1:s,str_hmac_sha1:function(t,e){return a(s(t,e))},str_sha1:function(e){return a(t(o(e),8*e.length))}}}),function(e,n){"function"==typeof t&&t.amd?t("strophe-md5",function(){return n()}):e.MD5=n()}(this,function(t){var e=function(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n},n=function(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e},s=function(t,n,s,i,r,o){return e((a=e(e(n,t),e(i,o)))<<(h=r)|a>>>32-h,s);var a,h},i=function(t,e,n,i,r,o,a){return s(e&n|~e&i,t,e,r,o,a)},r=function(t,e,n,i,r,o,a){return s(e&i|n&~i,t,e,r,o,a)},o=function(t,e,n,i,r,o,a){return s(e^n^i,t,e,r,o,a)},a=function(t,e,n,i,r,o,a){return s(n^(e|~i),t,e,r,o,a)},h=function(t,n){t[n>>5]|=128<<n%32,t[14+(n+64>>>9<<4)]=n;for(var s,h,c,u,l=1732584193,d=-271733879,_=-1732584194,p=271733878,m=0;m<t.length;m+=16)s=l,h=d,c=_,u=p,l=i(l,d,_,p,t[m+0],7,-680876936),p=i(p,l,d,_,t[m+1],12,-389564586),_=i(_,p,l,d,t[m+2],17,606105819),d=i(d,_,p,l,t[m+3],22,-1044525330),l=i(l,d,_,p,t[m+4],7,-176418897),p=i(p,l,d,_,t[m+5],12,1200080426),_=i(_,p,l,d,t[m+6],17,-1473231341),d=i(d,_,p,l,t[m+7],22,-45705983),l=i(l,d,_,p,t[m+8],7,1770035416),p=i(p,l,d,_,t[m+9],12,-1958414417),_=i(_,p,l,d,t[m+10],17,-42063),d=i(d,_,p,l,t[m+11],22,-1990404162),l=i(l,d,_,p,t[m+12],7,1804603682),p=i(p,l,d,_,t[m+13],12,-40341101),_=i(_,p,l,d,t[m+14],17,-1502002290),d=i(d,_,p,l,t[m+15],22,1236535329),l=r(l,d,_,p,t[m+1],5,-165796510),p=r(p,l,d,_,t[m+6],9,-1069501632),_=r(_,p,l,d,t[m+11],14,643717713),d=r(d,_,p,l,t[m+0],20,-373897302),l=r(l,d,_,p,t[m+5],5,-701558691),p=r(p,l,d,_,t[m+10],9,38016083),_=r(_,p,l,d,t[m+15],14,-660478335),d=r(d,_,p,l,t[m+4],20,-405537848),l=r(l,d,_,p,t[m+9],5,568446438),p=r(p,l,d,_,t[m+14],9,-1019803690),_=r(_,p,l,d,t[m+3],14,-187363961),d=r(d,_,p,l,t[m+8],20,1163531501),l=r(l,d,_,p,t[m+13],5,-1444681467),p=r(p,l,d,_,t[m+2],9,-51403784),_=r(_,p,l,d,t[m+7],14,1735328473),d=r(d,_,p,l,t[m+12],20,-1926607734),l=o(l,d,_,p,t[m+5],4,-378558),p=o(p,l,d,_,t[m+8],11,-2022574463),_=o(_,p,l,d,t[m+11],16,1839030562),d=o(d,_,p,l,t[m+14],23,-35309556),l=o(l,d,_,p,t[m+1],4,-1530992060),p=o(p,l,d,_,t[m+4],11,1272893353),_=o(_,p,l,d,t[m+7],16,-155497632),d=o(d,_,p,l,t[m+10],23,-1094730640),l=o(l,d,_,p,t[m+13],4,681279174),p=o(p,l,d,_,t[m+0],11,-358537222),_=o(_,p,l,d,t[m+3],16,-722521979),d=o(d,_,p,l,t[m+6],23,76029189),l=o(l,d,_,p,t[m+9],4,-640364487),p=o(p,l,d,_,t[m+12],11,-421815835),_=o(_,p,l,d,t[m+15],16,530742520),d=o(d,_,p,l,t[m+2],23,-995338651),l=a(l,d,_,p,t[m+0],6,-198630844),p=a(p,l,d,_,t[m+7],10,1126891415),_=a(_,p,l,d,t[m+14],15,-1416354905),d=a(d,_,p,l,t[m+5],21,-57434055),l=a(l,d,_,p,t[m+12],6,1700485571),p=a(p,l,d,_,t[m+3],10,-1894986606),_=a(_,p,l,d,t[m+10],15,-1051523),d=a(d,_,p,l,t[m+1],21,-2054922799),l=a(l,d,_,p,t[m+8],6,1873313359),p=a(p,l,d,_,t[m+15],10,-30611744),_=a(_,p,l,d,t[m+6],15,-1560198380),d=a(d,_,p,l,t[m+13],21,1309151649),l=a(l,d,_,p,t[m+4],6,-145523070),p=a(p,l,d,_,t[m+11],10,-1120210379),_=a(_,p,l,d,t[m+2],15,718787259),d=a(d,_,p,l,t[m+9],21,-343485551),l=e(l,s),d=e(d,h),_=e(_,c),p=e(p,u);return[l,d,_,p]};return{hexdigest:function(t){return function(t){for(var e="",n=0;n<4*t.length;n++)e+="0123456789abcdef".charAt(t[n>>2]>>n%4*8+4&15)+"0123456789abcdef".charAt(t[n>>2]>>n%4*8&15);return e}(h(n(t),8*t.length))},hash:function(t){return function(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e}(h(n(t),8*t.length))}}}),function(e,n){"function"==typeof t&&t.amd?t("strophe-utils",function(){return n()}):e.stropheUtils=n()}(this,function(){return{utf16to8:function(t){var e,n,s="",i=t.length;for(e=0;e<i;e++)(n=t.charCodeAt(e))>=0&&n<=127?s+=t.charAt(e):n>2047?(s+=String.fromCharCode(224|n>>12&15),s+=String.fromCharCode(128|n>>6&63),s+=String.fromCharCode(128|n>>0&63)):(s+=String.fromCharCode(192|n>>6&31),s+=String.fromCharCode(128|n>>0&63));return s},addCookies:function(t){var n,s,i,o,a,h,c;for(n in t||{})a="",h="",c="",i="object"==e(s=t[n]),o=escape(unescape(i?s.value:s)),i&&(a=s.expires?";expires="+s.expires:"",h=s.domain?";domain="+s.domain:"",c=s.path?";path="+s.path:""),r.cookie=n+"="+o+a+h+c}}}),function(e,n){if("function"!=typeof t||!t.amd)return n();t("strophe-polyfill",[],function(){return n()})}(0,function(){Function.prototype.bind||(Function.prototype.bind=function(t){var e=this,n=Array.prototype.slice,s=Array.prototype.concat,i=n.call(arguments,1);return function(){return e.apply(t||this,s.call(i,n.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length,n=Number(arguments[1])||0;for((n=n<0?Math.ceil(n):Math.floor(n))<0&&(n+=e);n<e;n++)if(n in this&&this[n]===t)return n;return-1})}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n,s;if(null===this)throw new TypeError(" this is null or not defined");var i=Object(this),r=i.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=e),s=0;s<r;){var o;s in i&&(o=i[s],t.call(n,o,s,i)),s++}}),function(e,n){if("function"==typeof t&&t.amd)t("strophe-core",["strophe-sha1","strophe-base64","strophe-md5","strophe-utils","strophe-polyfill"],function(){return n.apply(this,arguments)});else{var s=n(e.SHA1,e.Base64,e.MD5,e.stropheUtils,e.Strophe);e.Strophe=s.Strophe,e.$build=s.$build,e.$iq=s.$iq,e.$msg=s.$msg,e.$pres=s.$pres,e.SHA1=s.SHA1,e.Base64=s.Base64,e.MD5=s.MD5,e.b64_hmac_sha1=s.SHA1.b64_hmac_sha1,e.b64_sha1=s.SHA1.b64_sha1,e.str_hmac_sha1=s.SHA1.str_hmac_sha1,e.str_sha1=s.SHA1.str_sha1,module.exports=e}}(this,function(t,n,s,a,h){function c(t,e){return new h.Builder(t,e)}function u(t){return new h.Builder("iq",t)}function l(t){return new h.Builder("presence",t)}return(h={VERSION:"1.2.9",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(t){for(var e=0;e<h.XHTML.tags.length;e++)if(t==h.XHTML.tags[e])return!0;return!1},validAttribute:function(t,e){if(void 0!==h.XHTML.attributes[t]&&h.XHTML.attributes[t].length>0)for(var n=0;n<h.XHTML.attributes[t].length;n++)if(e==h.XHTML.attributes[t][n])return!0;return!1},validCSS:function(t){for(var e=0;e<h.XHTML.css.length;e++)if(t==h.XHTML.css[e])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(t,e){h.NS[t]=e},forEachChild:function(t,e,n){var s,i;for(s=0;s<t.childNodes.length;s++)(i=t.childNodes[s]).nodeType!=h.ElementType.NORMAL||e&&!this.isTagEqual(i,e)||n(i)},isTagEqual:function(t,e){return t.tagName==e},_xmlGenerator:null,_makeGenerator:function(){var t;return void 0===r.implementation.createDocument||r.implementation.createDocument&&r.documentMode&&r.documentMode<10?(t=this._getIEXmlDom()).appendChild(t.createElement("strophe")):t=r.implementation.createDocument("jabber:client","strophe",null),t},xmlGenerator:function(){return h._xmlGenerator||(h._xmlGenerator=h._makeGenerator()),h._xmlGenerator},_getIEXmlDom:function(){for(var t=null,e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<e.length&&null===t;n++)try{t=new ActiveXObject(e[n])}catch(s){t=null}return t},xmlElement:function(t){if(!t)return null;var n,s,i,r=h.xmlGenerator().createElement(t);for(n=1;n<arguments.length;n++){var o=arguments[n];if(o)if("string"==typeof o||"number"==typeof o)r.appendChild(h.xmlTextNode(o));else if("object"==e(o)&&"function"==typeof o.sort)for(s=0;s<o.length;s++){var a=o[s];"object"==e(a)&&"function"==typeof a.sort&&void 0!==a[1]&&null!==a[1]&&r.setAttribute(a[0],a[1])}else if("object"==e(o))for(i in o)o.hasOwnProperty(i)&&void 0!==o[i]&&null!==o[i]&&r.setAttribute(i,o[i])}return r},xmlescape:function(t){return t=(t=(t=(t=(t=t.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(t){return t=(t=(t=(t=(t=t.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(t){return h.xmlGenerator().createTextNode(t)},xmlHtmlNode:function(t){var e;o.DOMParser?e=(new i).parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t));return e},getText:function(t){if(!t)return null;var e="";0===t.childNodes.length&&t.nodeType==h.ElementType.TEXT&&(e+=t.nodeValue);for(var n=0;n<t.childNodes.length;n++)t.childNodes[n].nodeType==h.ElementType.TEXT&&(e+=t.childNodes[n].nodeValue);return h.xmlescape(e)},copyElement:function(t){var e,n;if(t.nodeType==h.ElementType.NORMAL){for(n=h.xmlElement(t.tagName),e=0;e<t.attributes.length;e++)n.setAttribute(t.attributes[e].nodeName,t.attributes[e].value);for(e=0;e<t.childNodes.length;e++)n.appendChild(h.copyElement(t.childNodes[e]))}else t.nodeType==h.ElementType.TEXT&&(n=h.xmlGenerator().createTextNode(t.nodeValue));return n},createHtml:function(t){var n,s,i,r,o,a,c,u,l,d,_;if(t.nodeType==h.ElementType.NORMAL)if(r=t.nodeName.toLowerCase(),h.XHTML.validTag(r))try{for(s=h.xmlElement(r),n=0;n<h.XHTML.attributes[r].length;n++)if(o=h.XHTML.attributes[r][n],null!=(a=t.getAttribute(o))&&""!==a&&!1!==a&&0!==a)if("style"==o&&"object"==e(a)&&void 0!==a.cssText&&(a=a.cssText),"style"==o){for(c=[],u=a.split(";"),i=0;i<u.length;i++)d=(l=u[i].split(":"))[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),h.XHTML.validCSS(d)&&(_=l[1].replace(/^\s*/,"").replace(/\s*$/,""),c.push(d+": "+_));c.length>0&&(a=c.join("; "),s.setAttribute(o,a))}else s.setAttribute(o,a);for(n=0;n<t.childNodes.length;n++)s.appendChild(h.createHtml(t.childNodes[n]))}catch(p){s=h.xmlTextNode("")}else for(s=h.xmlGenerator().createDocumentFragment(),n=0;n<t.childNodes.length;n++)s.appendChild(h.createHtml(t.childNodes[n]));else if(t.nodeType==h.ElementType.FRAGMENT)for(s=h.xmlGenerator().createDocumentFragment(),n=0;n<t.childNodes.length;n++)s.appendChild(h.createHtml(t.childNodes[n]));else t.nodeType==h.ElementType.TEXT&&(s=h.xmlTextNode(t.nodeValue));return s},escapeNode:function(t){return"string"!=typeof t?t:t.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(t){return"string"!=typeof t?t:t.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(t){return t.indexOf("@")<0?null:t.split("@")[0]},getDomainFromJid:function(t){var e=h.getBareJidFromJid(t);if(e.indexOf("@")<0)return e;var n=e.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(t){var e=t.split("/");return e.length<2?null:(e.splice(0,1),e.join("/"))},getBareJidFromJid:function(t){return t?t.split("/")[0]:null},_handleError:function(t){void 0!==t.stack&&h.fatal(t.stack),t.sourceURL?h.fatal("error: "+this.handler+" "+t.sourceURL+":"+t.line+" - "+t.name+": "+t.message):t.fileName?h.fatal("error: "+this.handler+" "+t.fileName+":"+t.lineNumber+" - "+t.name+": "+t.message):h.fatal("error: "+t.message)},log:function(t,e){},debug:function(t){this.log(this.LogLevel.DEBUG,t)},info:function(t){this.log(this.LogLevel.INFO,t)},warn:function(t){this.log(this.LogLevel.WARN,t)},error:function(t){this.log(this.LogLevel.ERROR,t)},fatal:function(t){this.log(this.LogLevel.FATAL,t)},serialize:function(t){var e;if(!t)return null;"function"==typeof t.tree&&(t=t.tree());var n,s,i=t.nodeName;for(t.getAttribute("_realname")&&(i=t.getAttribute("_realname")),e="<"+i,n=0;n<t.attributes.length;n++)"_realname"!=t.attributes[n].nodeName&&(e+=" "+t.attributes[n].nodeName+"='"+h.xmlescape(t.attributes[n].value)+"'");if(t.childNodes.length>0){for(e+=">",n=0;n<t.childNodes.length;n++)switch((s=t.childNodes[n]).nodeType){case h.ElementType.NORMAL:e+=h.serialize(s);break;case h.ElementType.TEXT:e+=h.xmlescape(s.nodeValue);break;case h.ElementType.CDATA:e+="<![CDATA["+s.nodeValue+"]]>"}e+="</"+i+">"}else e+="/>";return e},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(t,e){h._connectionPlugins[t]=e}}).Builder=function(t,e){"presence"!=t&&"message"!=t&&"iq"!=t||(e&&!e.xmlns?e.xmlns=h.NS.CLIENT:e||(e={xmlns:h.NS.CLIENT})),this.nodeTree=h.xmlElement(t,e),this.node=this.nodeTree},h.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return h.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(t){for(var e in t)t.hasOwnProperty(e)&&(void 0===t[e]?this.node.removeAttribute(e):this.node.setAttribute(e,t[e]));return this},c:function(t,e,n){var s=h.xmlElement(t,e,n);return this.node.appendChild(s),"string"!=typeof n&&"number"!=typeof n&&(this.node=s),this},cnode:function(t){var e,n=h.xmlGenerator();try{e=void 0!==n.importNode}catch(i){e=!1}var s=e?n.importNode(t,!0):h.copyElement(t);return this.node.appendChild(s),this.node=s,this},t:function(t){var e=h.xmlTextNode(t);return this.node.appendChild(e),this},h:function(t){var e=r.createElement("body");e.innerHTML=t;for(var n=h.createHtml(e);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},h.Handler=function(t,e,n,s,i,r,o){this.handler=t,this.ns=e,this.name=n,this.type=s,this.id=i,this.options=o||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(h.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=r?h.getBareJidFromJid(r):null:this.from=r,this.user=!0},h.Handler.prototype={getNamespace:function(t){var e=t.getAttribute("xmlns");return e&&this.options.ignoreNamespaceFragment&&(e=e.split("#")[0]),e},namespaceMatch:function(t){var e=!1;if(!this.ns)return!0;var n=this;return h.forEachChild(t,null,function(t){n.getNamespace(t)===n.ns&&(e=!0)}),e=e||this.getNamespace(t)===this.ns},isMatch:function(t){var e=t.getAttribute("from");this.options.matchBareFromJid&&(e=h.getBareJidFromJid(e));var n=t.getAttribute("type");return!(!this.namespaceMatch(t)||this.name&&!h.isTagEqual(t,this.name)||this.type&&(Array.isArray(this.type)?-1==this.type.indexOf(n):n!=this.type)||this.id&&t.getAttribute("id")!=this.id||this.from&&e!=this.from)},run:function(t){var e=null;try{e=this.handler(t)}catch(n){throw h._handleError(n),n}return e},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},h.TimedHandler=function(t,e){this.period=t,this.handler=e,this.lastCalled=(new Date).getTime(),this.user=!0},h.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},h.Connection=function(t,e){this.service=t,this.options=e||{};var n=this.options.protocol||"";for(var s in 0===t.indexOf("ws:")||0===t.indexOf("wss:")||0===n.indexOf("ws")?this._proto=new h.Websocket(this):this._proto=new h.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100),a.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),h._connectionPlugins)if(h._connectionPlugins.hasOwnProperty(s)){var i=h._connectionPlugins[s],r=function(){};r.prototype=i,this[s]=new r,this[s].init(this)}},h.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(t){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)});return"string"==typeof t||"number"==typeof t?e+":"+t:e+""},addProtocolErrorHandler:function(t,e,n){this.protocolErrorHandlers[t][e]=n},connect:function(t,e,n,s,i,r,o){this.jid=t,this.authzid=h.getBareJidFromJid(this.jid),this.authcid=o||h.getNodeFromJid(this.jid),this.pass=e,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=h.getDomainFromJid(this.jid),this._changeConnectStatus(h.Status.CONNECTING,null),this._proto._connect(s,i,r)},attach:function(t,e,n,s,i,r,o){if(!(this._proto instanceof h.Bosh))throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};this._proto._attach(t,e,n,s,i,r,o)},restore:function(t,e,n,s,i){if(!this._sessionCachingSupported())throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};this._proto._restore(t,e,n,s,i)},_sessionCachingSupported:function(){if(this._proto instanceof h.Bosh){if(!JSON)return!1;try{o.sessionStorage.setItem("_strophe_","_strophe_"),o.sessionStorage.removeItem("_strophe_")}catch(t){return!1}return!0}return!1},xmlInput:function(t){},xmlOutput:function(t){},rawInput:function(t){},rawOutput:function(t){},nextValidRid:function(t){},send:function(t){if(null!==t){if("function"==typeof t.sort)for(var e=0;e<t.length;e++)this._queueData(t[e]);else"function"==typeof t.tree?this._queueData(t.tree()):this._queueData(t);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(t,e,n,s){var i=null,r=this;"function"==typeof t.tree&&(t=t.tree());var o=t.getAttribute("id");o||(o=this.getUniqueId("sendIQ"),t.setAttribute("id",o));var a=t.getAttribute("to"),c=this.jid,u=this.addHandler(function(t){i&&r.deleteTimedHandler(i);var s=!1,o=t.getAttribute("from");if(o!==a&&(a||o!==h.getBareJidFromJid(c)&&o!==h.getDomainFromJid(c)&&o!==c)||(s=!0),!s)throw{name:"StropheError",message:"Got answer to IQ from wrong jid:"+o+"\nExpected jid: "+a};var u=t.getAttribute("type");if("result"==u)e&&e(t);else{if("error"!=u)throw{name:"StropheError",message:"Got bad IQ type of "+u};n&&n(t)}},null,"iq",["error","result"],o);return s&&(i=this.addTimedHandler(s,function(){return r.deleteHandler(u),n&&n(null),!1})),this.send(t),o},_queueData:function(t){if(null===t||!t.tagName||!t.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(t)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(t,e){var n=new h.TimedHandler(t,e);return this.addTimeds.push(n),n},deleteTimedHandler:function(t){this.removeTimeds.push(t)},addHandler:function(t,e,n,s,i,r,o){var a=new h.Handler(t,e,n,s,i,r,o);return this.addHandlers.push(a),a},deleteHandler:function(t){this.removeHandlers.push(t);var e=this.addHandlers.indexOf(t);e>=0&&this.addHandlers.splice(e,1)},registerSASLMechanisms:function(t){this.mechanisms={},(t=t||[h.SASLAnonymous,h.SASLExternal,h.SASLMD5,h.SASLOAuthBearer,h.SASLPlain,h.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(t){this.mechanisms[t.prototype.name]=t},disconnect:function(t){if(this._changeConnectStatus(h.Status.DISCONNECTING,t),h.info("Disconnect was called because: "+t),this.connected){var e=!1;this.disconnecting=!0,this.authenticated&&(e=l({xmlns:h.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else h.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests()},_changeConnectStatus:function(t,e){for(var n in h._connectionPlugins)if(h._connectionPlugins.hasOwnProperty(n)){var s=this[n];if(s.statusChanged)try{s.statusChanged(t,e)}catch(i){h.error(n+" plugin caused an exception changing status: "+i)}}if(this.connect_callback)try{this.connect_callback(t,e)}catch(r){h._handleError(r),h.error("User connection callback caused an exception: "+r)}},_doDisconnect:function(t){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),h.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(h.Status.DISCONNECTED,t),this.connected=!1},_dataRecv:function(t,e){h.info("_dataRecv called");var n=this._proto._reqToData(t);if(null!==n){var s,i;for(this.xmlInput!==h.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==h.Connection.prototype.rawInput&&(e?this.rawInput(e):this.rawInput(h.serialize(n)));this.removeHandlers.length>0;)i=this.removeHandlers.pop(),(s=this.handlers.indexOf(i))>=0&&this.handlers.splice(s,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var r,o,a=n.getAttribute("type");if(null!==a&&"terminate"==a){if(this.disconnecting)return;return r=n.getAttribute("condition"),o=n.getElementsByTagName("conflict"),null!==r?("remote-stream-error"==r&&o.length>0&&(r="conflict"),this._changeConnectStatus(h.Status.CONNFAIL,r)):this._changeConnectStatus(h.Status.CONNFAIL,"unknown"),void this._doDisconnect(r)}var c=this;h.forEachChild(n,null,function(t){var e,n;for(n=c.handlers,c.handlers=[],e=0;e<n.length;e++){var s=n[e];try{!s.isMatch(t)||!c.authenticated&&s.user?c.handlers.push(s):s.run(t)&&c.handlers.push(s)}catch(i){h.warn("Removing Strophe handlers due to uncaught exception: "+i.message)}}})}}},mechanisms:{},_connect_cb:function(t,e,n){var s;h.info("_connect_cb was called"),this.connected=!0;try{s=this._proto._reqToData(t)}catch(c){if("badformat"!=c)throw c;this._changeConnectStatus(h.Status.CONNFAIL,"bad-format"),this._doDisconnect("bad-format")}if(s&&(this.xmlInput!==h.Connection.prototype.xmlInput&&(s.nodeName===this._proto.strip&&s.childNodes.length?this.xmlInput(s.childNodes[0]):this.xmlInput(s)),this.rawInput!==h.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(h.serialize(s))),this._proto._connect_cb(s)!==h.Status.CONNFAIL))if(s.getElementsByTagNameNS?s.getElementsByTagNameNS(h.NS.STREAM,"features").length>0:s.getElementsByTagName("stream:features").length>0||s.getElementsByTagName("features").length>0){var i,r,o=[],a=s.getElementsByTagName("mechanism");if(a.length>0)for(i=0;i<a.length;i++)r=h.getText(a[i]),this.mechanisms[r]&&o.push(this.mechanisms[r]);0!==o.length||0!==s.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(o):this._proto._no_auth_received(e)}else try{this._proto._no_auth_received(e)}catch(c){}},sortMechanismsByPriority:function(t){var e,n,s,i;for(e=0;e<t.length-1;++e){for(s=e,n=e+1;n<t.length;++n)t[n].prototype.priority>t[s].prototype.priority&&(s=n);s!=e&&(i=t[e],t[e]=t[s],t[s]=i)}return t},_attemptSASLAuth:function(t){t=this.sortMechanismsByPriority(t||[]);var e=0,s=!1;for(e=0;e<t.length;++e)if(t[e].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new t[e],this._sasl_mechanism.onStart(this);var i=c("auth",{xmlns:h.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var r=this._sasl_mechanism.onChallenge(this,null);i.t(n.encode(r))}this.send(i.tree()),s=!0;break}return s},_attemptLegacyAuth:function(){null===h.getNodeFromJid(this.jid)?(this._changeConnectStatus(h.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(h.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(u({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:h.NS.AUTH}).c("username",{}).t(h.getNodeFromJid(this.jid)).tree()))},authenticate:function(t){this._attemptSASLAuth(t)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(t){var e=n.decode(h.getText(t)),s=this._sasl_mechanism.onChallenge(this,e),i=c("response",{xmlns:h.NS.SASL});return""!==s&&i.t(n.encode(s)),this.send(i.tree()),!0},_auth1_cb:function(t){var e=u({type:"set",id:"_auth_2"}).c("query",{xmlns:h.NS.AUTH}).c("username",{}).t(h.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return h.getResourceFromJid(this.jid)||(this.jid=h.getBareJidFromJid(this.jid)+"/strophe"),e.up().c("resource",{}).t(h.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(e.tree()),!1},_sasl_success_cb:function(t){if(this._sasl_data["server-signature"]){var e,s=n.decode(h.getText(t)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"==s[1]&&(e=s[2]),e!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}h.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var i=[],r=function(t,e){for(;t.length;)this.deleteHandler(t.pop());return this._sasl_auth1_cb.bind(this)(e),!1};return i.push(this._addSysHandler(function(t){r.bind(this)(i,t)}.bind(this),null,"stream:features",null,null)),i.push(this._addSysHandler(function(t){r.bind(this)(i,t)}.bind(this),h.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(t){var e,n;for(this.features=t,e=0;e<t.childNodes.length;e++)"bind"==(n=t.childNodes[e]).nodeName&&(this.do_bind=!0),"session"==n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(h.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var s=h.getResourceFromJid(this.jid);return s?this.send(u({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:h.NS.BIND}).c("resource",{}).t(s).tree()):this.send(u({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:h.NS.BIND}).tree()),!1},_sasl_bind_cb:function(t){var e;if("error"==t.getAttribute("type"))return h.info("SASL binding failed."),t.getElementsByTagName("conflict").length>0&&(e="conflict"),this._changeConnectStatus(h.Status.AUTHFAIL,e),!1;var n,s=t.getElementsByTagName("bind");if(!(s.length>0))return h.info("SASL binding failed."),this._changeConnectStatus(h.Status.AUTHFAIL,null),!1;(n=s[0].getElementsByTagName("jid")).length>0&&(this.jid=h.getText(n[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(u({type:"set",id:"_session_auth_2"}).c("session",{xmlns:h.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(h.Status.CONNECTED,null)))},_sasl_session_cb:function(t){if("result"==t.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(h.Status.CONNECTED,null);else if("error"==t.getAttribute("type"))return h.info("Session creation failed."),this._changeConnectStatus(h.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(t){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(h.Status.AUTHFAIL,null),!1},_auth2_cb:function(t){return"result"==t.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(h.Status.CONNECTED,null)):"error"==t.getAttribute("type")&&(this._changeConnectStatus(h.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(t,e){var n=new h.TimedHandler(t,e);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(t,e,n,s,i){var r=new h.Handler(t,e,n,s,i);return r.user=!1,this.addHandlers.push(r),r},_onDisconnectTimeout:function(){return h.info("_onDisconnectTimeout was called"),this._changeConnectStatus(h.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var t,e,n;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)e=this.removeTimeds.pop(),(t=this.timedHandlers.indexOf(e))>=0&&this.timedHandlers.splice(t,1);var s=(new Date).getTime();for(n=[],t=0;t<this.timedHandlers.length;t++)e=this.timedHandlers[t],!this.authenticated&&e.user||(e.lastCalled+e.period-s<=0?e.run()&&n.push(e):n.push(e));this.timedHandlers=n,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100))}},h.SASLMechanism=function(t,e,n){this.name=t,this.isClientFirst=e,this.priority=n},h.SASLMechanism.prototype={test:function(t){return!0},onStart:function(t){this._connection=t},onChallenge:function(t,e){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},h.SASLAnonymous=function(){},h.SASLAnonymous.prototype=new h.SASLMechanism("ANONYMOUS",!1,10),h.SASLAnonymous.prototype.test=function(t){return null===t.authcid},h.SASLPlain=function(){},h.SASLPlain.prototype=new h.SASLMechanism("PLAIN",!0,20),h.SASLPlain.prototype.test=function(t){return null!==t.authcid},h.SASLPlain.prototype.onChallenge=function(t){var e=t.authzid;return e+="\0",e+=t.authcid,e+="\0",e+=t.pass,a.utf16to8(e)},h.SASLSHA1=function(){},h.SASLSHA1.prototype=new h.SASLMechanism("SCRAM-SHA-1",!0,40),h.SASLSHA1.prototype.test=function(t){return null!==t.authcid},h.SASLSHA1.prototype.onChallenge=function(e,i,r){var o=r||s.hexdigest(1234567890*Math.random()),h="n="+a.utf16to8(e.authcid);return h+=",r=",h+=o,e._sasl_data.cnonce=o,e._sasl_data["client-first-message-bare"]=h,h="n,,"+h,this.onChallenge=function(e,s){for(var i,r,o,h,c,u,l,d,_,p,m,f,g="c=biws,",S=e._sasl_data["client-first-message-bare"]+","+s+",",b=e._sasl_data.cnonce,y=/([a-z]+)=([^,]+)(,|$)/;s.match(y);){var v=s.match(y);switch(s=s.replace(v[0],""),v[1]){case"r":i=v[2];break;case"s":r=v[2];break;case"i":o=v[2]}}if(i.substr(0,b.length)!==b)return e._sasl_data={},e._sasl_failure_cb();for(S+=g+="r="+i,r=n.decode(r),r+="\0\0\0",_=a.utf16to8(e.pass),h=u=t.core_hmac_sha1(_,r),l=1;l<o;l++){for(c=t.core_hmac_sha1(_,t.binb2str(u)),d=0;d<5;d++)h[d]^=c[d];u=c}for(h=t.binb2str(h),p=t.core_hmac_sha1(h,"Client Key"),m=t.str_hmac_sha1(h,"Server Key"),f=t.core_hmac_sha1(t.str_sha1(t.binb2str(p)),S),e._sasl_data["server-signature"]=t.b64_hmac_sha1(m,S),d=0;d<5;d++)p[d]^=f[d];return g+=",p="+n.encode(t.binb2str(p))}.bind(this),h},h.SASLMD5=function(){},h.SASLMD5.prototype=new h.SASLMechanism("DIGEST-MD5",!1,30),h.SASLMD5.prototype.test=function(t){return null!==t.authcid},h.SASLMD5.prototype._quote=function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},h.SASLMD5.prototype.onChallenge=function(t,e,n){for(var i,r=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,o=n||s.hexdigest(""+1234567890*Math.random()),h="",c=null,u="";e.match(r);)switch(i=e.match(r),e=e.replace(i[0],""),i[2]=i[2].replace(/^"(.+)"$/,"$1"),i[1]){case"realm":h=i[2];break;case"nonce":u=i[2];break;case"qop":i[2];break;case"host":c=i[2]}var l=t.servtype+"/"+t.domain;null!==c&&(l=l+"/"+c);var d=a.utf16to8(t.authcid+":"+h+":"+this._connection.pass),_=s.hash(d)+":"+u+":"+o,p="AUTHENTICATE:"+l,m="";return m+="charset=utf-8,",m+="username="+this._quote(a.utf16to8(t.authcid))+",",m+="realm="+this._quote(h)+",",m+="nonce="+this._quote(u)+",",m+="nc=00000001,",m+="cnonce="+this._quote(o)+",",m+="digest-uri="+this._quote(l)+",",m+="response="+s.hexdigest(s.hexdigest(_)+":"+u+":00000001:"+o+":auth:"+s.hexdigest(p))+",",m+="qop=auth",this.onChallenge=function(){return""},m},h.SASLOAuthBearer=function(){},h.SASLOAuthBearer.prototype=new h.SASLMechanism("OAUTHBEARER",!0,50),h.SASLOAuthBearer.prototype.test=function(t){return null!==t.authcid},h.SASLOAuthBearer.prototype.onChallenge=function(t){var e="n,a=";return e+=t.authzid,e+=",",e+="",e+="auth=Bearer ",e+=t.pass,e+="",e+="",a.utf16to8(e)},h.SASLExternal=function(){},h.SASLExternal.prototype=new h.SASLMechanism("EXTERNAL",!0,60),h.SASLExternal.prototype.onChallenge=function(t){return t.authcid===t.authzid?"":t.authzid},{Strophe:h,$build:c,$msg:function(t){return new h.Builder("message",t)},$iq:u,$pres:l,SHA1:t,Base64:n,MD5:s}}),function(e,n){if("function"!=typeof t||!t.amd)return n(e.Strophe,e.$build);t("strophe-bosh",["strophe-core"],function(t){return n(t.Strophe,t.$build)})}(this,function(t,e){return t.Request=function(e,n,s,i){this.id=++t._requestId,this.xmlData=e,this.data=t.serialize(e),this.origFunc=n,this.func=n,this.rid=s,this.date=NaN,this.sends=i||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},t.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"==(e=this.xhr.responseXML.documentElement).tagName)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),t.error("responseXML: "+t.serialize(this.xhr.responseXML)),"parsererror"}else if(this.xhr.responseText)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),"badformat";return e},_newXHR:function(){var t=null;return o.XMLHttpRequest?(t=new XMLHttpRequest).overrideMimeType&&t.overrideMimeType("text/xml; charset=utf-8"):o.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),t.onreadystatechange=this.func.bind(null,this),t}},t.Bosh=function(t){this._conn=t,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this._requests=[]},t.Bosh.prototype={strip:null,_buildBody:function(){var n=e("body",{rid:this.rid++,xmlns:t.NS.HTTPBIND});return null!==this.sid&&n.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),n},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&o.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,n,s){this.wait=e||this.wait,this.hold=n||this.hold,this.errors=0;var i=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":t.NS.BOSH});s&&i.attrs({route:s});var r=this._conn._connect_cb;this._requests.push(new t.Request(i.tree(),this._onRequestStateChange.bind(this,r.bind(this._conn)),i.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,n,s,i,r,o,a){this._conn.jid=e,this.sid=n,this.rid=s,this._conn.connect_callback=i,this._conn.domain=t.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=r||this.wait,this.hold=o||this.hold,this.window=a||this.window,this._conn._changeConnectStatus(t.Status.ATTACHED,null)},_restore:function(e,n,s,i,r){var a=JSON.parse(o.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=a&&a.rid&&a.sid&&a.jid)||null!=e&&t.getBareJidFromJid(a.jid)!=t.getBareJidFromJid(e))throw{name:"StropheSessionError",message:"_restore: no restoreable session."};this._conn.restored=!0,this._attach(a.jid,a.sid,a.rid,n,s,i,r)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&o.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):o.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var n,s,i=e.getAttribute("type");if(null!==i&&"terminate"==i)return n=e.getAttribute("condition"),t.error("BOSH-Connection failed: "+n),s=e.getElementsByTagName("conflict"),null!==n?("remote-stream-error"==n&&s.length>0&&(n="conflict"),this._conn._changeConnectStatus(t.Status.CONNFAIL,n)):this._conn._changeConnectStatus(t.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),t.Status.CONNFAIL;this.sid||(this.sid=e.getAttribute("sid"));var r=e.getAttribute("requests");r&&(this.window=parseInt(r,10));var o=e.getAttribute("hold");o&&(this.hold=parseInt(o,10));var a=e.getAttribute("wait");a&&(this.wait=parseInt(a,10))},_disconnect:function(t){this._sendTerminate(t)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&o.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(t){var e,n=this._getRequestStatus(t);(e=this._conn.protocolErrorHandlers.HTTP[n])&&e.call(this,n)},_hitError:function(e){this.errors++,t.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var n=this._buildBody();this._requests.push(new t.Request(n.tree(),this._onRequestStateChange.bind(this,e.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var t;this._requests.length>0;)(t=this._requests.pop()).abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(t.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var n=this._buildBody(),s=0;s<e.length;s++)null!==e[s]&&("restart"===e[s]?n.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":t.NS.BOSH}):n.cnode(e[s]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new t.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var i=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(t.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),i>Math.floor(t.TIMEOUT*this.wait)&&(t.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(t.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,n){var s;if(4==e.xhr.readyState)try{s=e.xhr.status}catch(i){t.error("Caught an error while retrieving a request's status, reqStatus: "+s)}return void 0===s&&(s="number"==typeof n?n:0),s},_onRequestStateChange:function(e,n){if(t.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)n.abort=!1;else if(4===n.xhr.readyState){var s=this._getRequestStatus(n);if(this.disconnecting&&s>=400)return this._hitError(s),void this._callProtocolErrorHandlers(n);if((s>0&&s<500||n.sends>5)&&(this._removeRequest(n),t.debug("request id "+n.id+" should now be removed")),200==s){var i=this._requests[0]==n;(this._requests[1]==n||i&&this._requests.length>0&&this._requests[0].age()>Math.floor(t.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),t.debug("request id "+n.id+"."+n.sends+" got 200"),e(n),this.errors=0}else 0===s||s>=400&&s<600||s>=12e3?(t.error("request id "+n.id+"."+n.sends+" error "+s+" happened"),this._hitError(s),this._callProtocolErrorHandlers(n),s>=400&&s<500&&(this._conn._changeConnectStatus(t.Status.DISCONNECTING,null),this._conn._doDisconnect())):t.error("request id "+n.id+"."+n.sends+" error "+s+" happened");s>0&&s<500&&!(n.sends>5)||this._throttledRequestHandler()}},_processRequest:function(e){var n=this,s=this._requests[e],i=this._getRequestStatus(s,-1);if(s.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var r=s.age(),o=!isNaN(r)&&r>Math.floor(t.TIMEOUT*this.wait),a=null!==s.dead&&s.timeDead()>Math.floor(t.SECONDARY_TIMEOUT*this.wait),h=4==s.xhr.readyState&&(i<1||i>=500);if((o||a||h)&&(a&&t.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),s.abort=!0,s.xhr.abort(),s.xhr.onreadystatechange=function(){},this._requests[e]=new t.Request(s.xmlData,s.origFunc,s.rid,s.sends),s=this._requests[e]),0===s.xhr.readyState){t.debug("request id "+s.id+"."+s.sends+" posting");try{var c=this._conn.options.contentType||"text/xml; charset=utf-8";s.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==s.xhr.setRequestHeader&&s.xhr.setRequestHeader("Content-Type",c),this._conn.options.withCredentials&&(s.xhr.withCredentials=!0)}catch(d){return t.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(t.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var u=function(){if(s.date=new Date,n._conn.options.customHeaders){var t=n._conn.options.customHeaders;for(var e in t)t.hasOwnProperty(e)&&s.xhr.setRequestHeader(e,t[e])}s.xhr.send(s.data)};if(s.sends>1){var l=1e3*Math.min(Math.floor(t.TIMEOUT*this.wait),Math.pow(s.sends,3));setTimeout(function(){u()},l)}else u();s.sends++,this._conn.xmlOutput!==t.Connection.prototype.xmlOutput&&(s.xmlData.nodeName===this.strip&&s.xmlData.childNodes.length?this._conn.xmlOutput(s.xmlData.childNodes[0]):this._conn.xmlOutput(s.xmlData)),this._conn.rawOutput!==t.Connection.prototype.rawOutput&&this._conn.rawOutput(s.data)}else t.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+s.xhr.readyState)}},_removeRequest:function(e){var n;for(t.debug("removing request"),n=this._requests.length-1;n>=0;n--)e==this._requests[n]&&this._requests.splice(n,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(t){var e=this._requests[t];null===e.dead&&(e.dead=new Date),this._processRequest(t)},_reqToData:function(t){try{return t.getResponse()}catch(e){if("parsererror"!=e)throw e;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){t.info("_sendTerminate was called");var n=this._buildBody().attrs({type:"terminate"});e&&n.cnode(e.tree());var s=new t.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"));this._requests.push(s),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?t.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):t.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},t}),function(e,n){if("function"!=typeof t||!t.amd)return n(e.Strophe,e.$build);t("strophe-websocket",["strophe-core"],function(t){return n(t.Strophe,t.$build)})}(this,function(t,e){return t.Websocket=function(t){this._conn=t,this.strip="wrapper";var e=t.service;if(0!==e.indexOf("ws:")&&0!==e.indexOf("wss:")){var n="";"ws"===t.options.protocol&&"https:"!==o.location.protocol?n+="ws":n+="wss",n+="://"+o.location.host,0!==e.indexOf("/")?n+=o.location.pathname+e:n+=e,t.service=n}},t.Websocket.prototype={_buildStream:function(){return e("open",{xmlns:t.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,n){var s;if(0===(s=e.getElementsByTagNameNS?e.getElementsByTagNameNS(t.NS.STREAM,"error"):e.getElementsByTagName("stream:error")).length)return!1;for(var i=s[0],r="",o="",a=0;a<i.childNodes.length;a++){var h=i.childNodes[a];if("urn:ietf:params:xml:ns:xmpp-streams"!==h.getAttribute("xmlns"))break;"text"===h.nodeName?o=h.textContent:r=h.nodeName}var c="WebSocket stream error: ";return c+=r||"unknown",o&&(c+=" - "+r),t.error(c),this._conn._changeConnectStatus(n,r),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){var t=this;this.socket={onopen:this._onOpen,onmessage:this._connect_cb_wrapper,onerror:this._onError,onclose:this._onClose,send:function(t){wx.sendSocketMessage({data:t})}},wx.onSocketOpen(function(e){console.log("WebSocket 连接已打开！"),n=!0,t.socket.onopen.call(t)}),wx.onSocketMessage(function(e){console.log("onSocketMessage",e,JSON.stringify(e)),t.socket.onmessage.call(t,e)}),wx.onSocketClose(function(e){console.log("WebSocket 连接已经关闭！"),t.socket.onclose.call(t),t._onSocketClose&&t._onSocketClose(e)}),wx.connectSocket({url:this._conn.service,method:"GET"})},_connect_cb:function(e){if(this._check_streamerror(e,t.Status.CONNFAIL))return t.Status.CONNFAIL},_handleStreamStart:function(e){var n=!1,s=e.getAttribute("xmlns");"string"!=typeof s?n="Missing xmlns in <open />":s!==t.NS.FRAMING&&(n="Wrong xmlns in <open />: "+s);var i=e.getAttribute("version");return"string"!=typeof i?n="Missing version in <open />":"1.0"!==i&&(n="Wrong version in <open />: "+i),!n||(this._conn._changeConnectStatus(t.Status.CONNFAIL,n),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var n=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===n)return;var s=(new i).parseFromString(n,"text/xml").documentElement;this._conn.xmlInput(s),this._conn.rawInput(e.data),this._handleStreamStart(s)&&this._connect_cb(s)}else if(0===e.data.indexOf("<close ")){this._conn.rawInput(e.data),this._conn.xmlInput(e);var r=e.getAttribute("see-other-uri");r?(this._conn._changeConnectStatus(t.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=r,this._connect()):(this._conn._changeConnectStatus(t.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())}else{var o=this._streamWrap(e.data),a=(new i).parseFromString(o,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(a,null,e.data)}},_disconnect:function(n){if(console.log("_disconnect",this.socket.readyState,!!this.socket),this.socket){n&&this._conn.send(n);var s=e("close",{xmlns:t.NS.FRAMING});this._conn.xmlOutput(s);var i=t.serialize(s);this._conn.rawOutput(i);try{this.socket.send(i)}catch(r){t.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){t.info("WebSockets _doDisconnect was called"),this._closeSocket&&this._closeSocket()},_streamWrap:function(t){return"<wrapper>"+t+"</wrapper>"},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(t.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):t.info("Websocket closed")},_no_auth_received:function(e){t.error("Server did not send any auth methods"),this._conn._changeConnectStatus(t.Status.CONNFAIL,"Server did not send any auth methods"),e&&(e=e.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(t){wx.onSocketError(function(t){})},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var n=0;n<e.length;n++){var s,i;if(null!==e[n])s="restart"===e[n]?this._buildStream().tree():e[n],i=t.serialize(s),this._conn.xmlOutput(s),this._conn.rawOutput(i),wx.sendSocketMessage({data:i})}this._conn._data=[]}},_onMessage:function(e){var n,s,r='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===r)return this._conn.rawInput(r),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(n=(new i).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(n))return}else s=this._streamWrap(e.data),n=(new i).parseFromString(s,"text/xml").documentElement;return this._check_streamerror(n,t.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===n.firstChild.nodeName&&"unavailable"===n.firstChild.getAttribute("type")?(this._conn.xmlInput(n),void this._conn.rawInput(t.serialize(n))):void this._conn._dataRecv(n,e.data)},_onOpen:function(){t.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var n=t.serialize(e);this._conn.rawOutput(n),wx.sendSocketMessage({data:n})},_reqToData:function(t){return t},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},t}),"function"==typeof t&&t.amd&&t("strophe",["strophe-core","strophe-bosh","strophe-websocket"],function(t){return t}),s){if("function"!=typeof t||!t.amd)return s(a,h,c,u,l);var p=s;"function"==typeof requirejs?requirejs(["strophe"],function(t){p(t.Strophe,t.$build,t.$msg,t.$iq,t.$pres)}):require(["strophe"],function(t){p(t.Strophe,t.$build,t.$msg,t.$iq,t.$pres)})}}).bind(o)(function(t,e,n,s,i){});
},{"./xmldom/dom-parser":"A2Tl"}],"63GH":[function(require,module,exports) {
!function(){var E=0;exports.code={WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR:E++,WEBIM_CONNCTION_OPEN_ERROR:E++,WEBIM_CONNCTION_AUTH_ERROR:E++,WEBIM_CONNCTION_OPEN_USERGRID_ERROR:E++,WEBIM_CONNCTION_ATTACH_ERROR:E++,WEBIM_CONNCTION_ATTACH_USERGRID_ERROR:E++,WEBIM_CONNCTION_REOPEN_ERROR:E++,WEBIM_CONNCTION_SERVER_CLOSE_ERROR:E++,WEBIM_CONNCTION_SERVER_ERROR:E++,WEBIM_CONNCTION_IQ_ERROR:E++,WEBIM_CONNCTION_PING_ERROR:E++,WEBIM_CONNCTION_NOTIFYVERSION_ERROR:E++,WEBIM_CONNCTION_GETROSTER_ERROR:E++,WEBIM_CONNCTION_CROSSDOMAIN_ERROR:E++,WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES:E++,WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR:E++,WEBIM_CONNCTION_DISCONNECTED:E++,WEBIM_CONNCTION_AJAX_ERROR:E++,WEBIM_CONNCTION_JOINROOM_ERROR:E++,WEBIM_CONNCTION_GETROOM_ERROR:E++,WEBIM_CONNCTION_GETROOMINFO_ERROR:E++,WEBIM_CONNCTION_GETROOMMEMBER_ERROR:E++,WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR:E++,WEBIM_CONNCTION_LOAD_CHATROOM_ERROR:E++,WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR:E++,WEBIM_CONNCTION_JOINCHATROOM_ERROR:E++,WEBIM_CONNCTION_QUITCHATROOM_ERROR:E++,WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR:E++,WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR:E++,WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR:E++,WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR:E++,WEBIM_CONNCTION_CALLBACK_INNER_ERROR:E++,WEBIM_CONNCTION_CLIENT_OFFLINE:E++,WEBIM_CONNCTION_CLIENT_LOGOUT:E++,WEBIM_UPLOADFILE_BROWSER_ERROR:100,WEBIM_UPLOADFILE_ERROR:101,WEBIM_UPLOADFILE_NO_LOGIN:102,WEBIM_UPLOADFILE_NO_FILE:103,WEBIM_DOWNLOADFILE_ERROR:200,WEBIM_DOWNLOADFILE_NO_LOGIN:201,WEBIM_DOWNLOADFILE_BROWSER_ERROR:202,WEBIM_MESSAGE_REC_TEXT:300,WEBIM_MESSAGE_REC_TEXT_ERROR:301,WEBIM_MESSAGE_REC_EMOTION:302,WEBIM_MESSAGE_REC_PHOTO:303,WEBIM_MESSAGE_REC_AUDIO:304,WEBIM_MESSAGE_REC_AUDIO_FILE:305,WEBIM_MESSAGE_REC_VEDIO:306,WEBIM_MESSAGE_REC_VEDIO_FILE:307,WEBIM_MESSAGE_REC_FILE:308,WEBIM_MESSAGE_SED_TEXT:309,WEBIM_MESSAGE_SED_EMOTION:310,WEBIM_MESSAGE_SED_PHOTO:311,WEBIM_MESSAGE_SED_AUDIO:312,WEBIM_MESSAGE_SED_AUDIO_FILE:313,WEBIM_MESSAGE_SED_VEDIO:314,WEBIM_MESSAGE_SED_VEDIO_FILE:315,WEBIM_MESSAGE_SED_FILE:316,STATUS_INIT:400,STATUS_DOLOGIN_USERGRID:401,STATUS_DOLOGIN_IM:402,STATUS_OPENED:403,STATUS_CLOSING:404,STATUS_CLOSED:405,STATUS_ERROR:406}}();
},{}],"FO+Z":[function(require,module,exports) {
function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}!function(){var t,r,o,n,a=function(){},i=require("./status").code,s="undefined"!=typeof FormData,l="undefined"!=typeof Blob,p=(!1).setRequestHeader||!1,d=(!1).overrideMimeType||!1,c=p&&s,u=c||!1,f=p&&(l||d);Object.keys||(Object.keys=(t=Object.prototype.hasOwnProperty,r=!{toString:null}.propertyIsEnumerable("toString"),n=(o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(a){if("object"!==e(a)&&("function"!=typeof a||null===a))throw new TypeError("Object.keys called on non-object");var i,s,l=[];for(i in a)t.call(a,i)&&l.push(i);if(r)for(s=0;s<n;s++)t.call(a,o[s])&&l.push(o[s]);return l}));var y={hasFormData:s,hasBlob:l,emptyfn:a,isCanSetRequestHeader:p,hasOverrideMimeType:d,isCanUploadFileAsync:c,isCanUploadFile:u,isCanDownLoadFile:f,isSupportWss:!0,hasFlash:!1,xmlrequest:!1,stringify:function(t){if("undefined"!=typeof JSON&&JSON.stringify)return JSON.stringify(t);var r="",o=[];return function t(n){var a=!1;"[object Array]"===Object.prototype.toString.call(n)?(o.push("]","["),a=!0):"[object Object]"===Object.prototype.toString.call(n)&&o.push("}","{");for(var i in n)"[object Null]"===Object.prototype.toString.call(n[i])?n[i]="null":"[object Undefined]"===Object.prototype.toString.call(n[i])&&(n[i]="undefined"),n[i]&&"object"===e(n[i])?r+=","+(a?"":'"'+i+'":'+(a?'"':""))+t(n[i]):r+=',"'+(a?"":i+'":"')+n[i]+'"';""!=r&&(r=r.slice(1));return o.pop()+r+o.pop()}(t)},registerUser:function(e){var t=e.orgName||"",r=e.appName||"",o=e.appKey||"",n=e.success||a,s=e.error||a;if(!t&&!r&&o){var l=o.split("#");2===l.length&&(t=l[0],r=l[1])}if(!t&&!r)return s({type:i.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var p=e.apiUrl+"/"+t+"/"+r+"/users",d={username:e.username,password:e.password,nickname:e.nickname||""};return e={url:p,data:y.stringify(d),success:n,error:s},y.ajax(e)},login:function(e){var t=(e=e||{}).success||a,r=e.error||a,o=(e.appKey||"").split("#");if(2!==o.length)return r({type:i.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var n=o[0],s=o[1],l=e.user||"",p=e.pwd||"",d=e.apiUrl,c={grant_type:"password",username:l,password:p,timestamp:+new Date};return e={url:d+"/"+n+"/"+s+"/token",data:y.stringify(c),success:t,error:r},y.ajax(e)},getFileUrl:function(e){var t={url:"",filename:"",filetype:"",data:""},r="string"==typeof e?document.getElementById(e):e;if(!y.isCanUploadFileAsync||!r)return t;try{if(window.URL.createObjectURL){var o=r.files;if(o.length>0){var n=o.item(0);t.data=n,t.url=window.URL.createObjectURL(n),t.filename=n.name||""}}var a=t.filename.lastIndexOf(".");return-1!=a&&(t.filetype=t.filename.substring(a+1).toLowerCase()),t}catch(i){throw i}},getFileSize:function(e){var t=document.getElementById(e),r=0;return t&&t.files&&t.files.length>0&&(r=t.files[0].size),r},trim:function(e){return(e="string"==typeof e?e:"").trim?e.trim():e.replace(/^\s|\s$/g,"")},parseEmoji:function(e){if(void 0===WebIM.Emoji||void 0===WebIM.Emoji.map)return e;var t=WebIM.Emoji;for(var r in t.map)if(t.map.hasOwnProperty(r))for(;e.indexOf(r)>-1;)e=e.replace(r,'<image class="emoji" src="'+t.path+t.map[r]+'" /></image>');return e},parseLink:function(e){return e=e.replace(/(https?:\/\/|www\.)([a-zA-Z0-9-]+(\.[a-zA-Z0-9]+)+)(:[0-9]{2,4})?\/?((\.[:_0-9a-zA-Z-]+)|[:_0-9a-zA-Z-]*\/?)*\??[:_#@*&%0-9a-zA-Z-\/=]*/gm,function(e){return"<a href='"+(/^https?/gm.test(e)?e:"//"+e)+"' target='_blank'>"+e+"</a>"})},parseJSON:function(e){if(window.JSON&&window.JSON.parse)return window.JSON.parse(e+"");var t,r=null,o=y.trim(e+"");return o&&!y.trim(o.replace(/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,function(e,o,n,a){return t&&o&&(r=0),0===r?e:(t=n||o,r+=!a-!n,"")}))?Function("return "+o)():Function("Invalid JSON: "+e)()},parseUploadResponse:function(e){return e.indexOf("callback")>-1?e.slice(9,-1):e},parseDownloadResponse:function(e){return e&&e.type&&"application/json"===e.type||Object.prototype.toString.call(e).indexOf("Blob")<0?this.url+"?token=":window.URL.createObjectURL(e)},uploadFile:function(e){(e=e||{}).onFileUploadProgress=e.onFileUploadProgress||a,e.onFileUploadComplete=e.onFileUploadComplete||a,e.onFileUploadError=e.onFileUploadError||a,e.onFileUploadCanceled=e.onFileUploadCanceled||a;var t=e.accessToken||this.context.accessToken;if(t){var r,o,n,s=e.appKey||this.context.appKey||"";if(s&&(r=(n=s.split("#"))[0],o=n[1]),r||o){var l=e.apiUrl+"/"+r+"/"+o+"/chatfiles";if(y.isCanUploadFileAsync){var p=e.file.data?e.file.data.size:void 0;if(p>10485760)e.onFileUploadError({type:i.WEBIM_UPLOADFILE_ERROR,id:e.id});else if(p<=0)e.onFileUploadError({type:i.WEBIM_UPLOADFILE_ERROR,id:e.id});else{var d=y.xmlrequest();d.upload&&d.upload.addEventListener("progress",e.onFileUploadProgress,!1),d.addEventListener?(d.addEventListener("abort",e.onFileUploadCanceled,!1),d.addEventListener("load",function(t){try{var r=y.parseJSON(d.responseText);try{e.onFileUploadComplete(r)}catch(t){e.onFileUploadError({type:i.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:t})}}catch(t){e.onFileUploadError({type:i.WEBIM_UPLOADFILE_ERROR,data:d.responseText,id:e.id,xhr:d})}},!1),d.addEventListener("error",function(t){e.onFileUploadError({type:i.WEBIM_UPLOADFILE_ERROR,id:e.id,xhr:d})},!1)):d.onreadystatechange&&(d.onreadystatechange=function(){if(4===d.readyState)if(200===ajax.status)try{var t=y.parseJSON(d.responseText);e.onFileUploadComplete(t)}catch(r){e.onFileUploadError({type:i.WEBIM_UPLOADFILE_ERROR,data:d.responseText,id:e.id,xhr:d})}else e.onFileUploadError({type:i.WEBIM_UPLOADFILE_ERROR,data:d.responseText,id:e.id,xhr:d});else d.abort(),e.onFileUploadCanceled()}),d.open("POST",l),d.setRequestHeader("restrict-access","true"),d.setRequestHeader("Accept","*/*"),d.setRequestHeader("Authorization","Bearer "+t);var c=new FormData;c.append("file",e.file.data),d.send(c)}}else y.hasFlash&&"function"==typeof e.flashUpload?e.flashUpload&&e.flashUpload(l,e):e.onFileUploadError({type:i.WEBIM_UPLOADFILE_BROWSER_ERROR,id:e.id})}else e.onFileUploadError({type:i.WEBIM_UPLOADFILE_ERROR,id:e.id})}else e.onFileUploadError({type:i.WEBIM_UPLOADFILE_NO_LOGIN,id:e.id})},download:function(e){e.onFileDownloadComplete=e.onFileDownloadComplete||a,e.onFileDownloadError=e.onFileDownloadError||a;var t=e.accessToken||this.context.accessToken,r=y.xmlrequest();if(t){if(y.isCanDownLoadFile){"addEventListener"in r?(r.addEventListener("load",function(t){e.onFileDownloadComplete(r.response,r)},!1),r.addEventListener("error",function(t){e.onFileDownloadError({type:i.WEBIM_DOWNLOADFILE_ERROR,id:e.id,xhr:r})},!1)):"onreadystatechange"in r&&(r.onreadystatechange=function(){4===r.readyState?200===ajax.status?e.onFileDownloadComplete(r.response,r):e.onFileDownloadError({type:i.WEBIM_DOWNLOADFILE_ERROR,id:e.id,xhr:r}):(r.abort(),e.onFileDownloadError({type:i.WEBIM_DOWNLOADFILE_ERROR,id:e.id,xhr:r}))});var o=e.method||"GET",n=e.responseType||"blob",s=e.mimeType||"text/plain; charset=x-user-defined";r.open(o,e.url),"undefined"!=typeof Blob?r.responseType=n:r.overrideMimeType(s);var l={"X-Requested-With":"XMLHttpRequest",Accept:"application/octet-stream","share-secret":e.secret,Authorization:"Bearer "+t},p=e.headers||{};for(var d in p)l[d]=p[d];for(var c in l)l[c]&&r.setRequestHeader(c,l[c]);r.send(null)}else e.onFileDownloadComplete()}else e.onFileDownloadError({type:i.WEBIM_DOWNLOADFILE_NO_LOGIN,id:e.id})},parseTextMessage:function(e,t){if("string"!=typeof e)return!1;if("[object Object]"!==Object.prototype.toString.call(t))return{isemoji:!1,body:[{type:"txt",data:e}]};var r=e,o=[],n=r.match(/\[[^[\]]{2,3}\]/gm);if(!n||n.length<1)return{isemoji:!1,body:[{type:"txt",data:e}]};for(var a=!1,i=0;i<n.length;i++){var s=r.substring(0,r.indexOf(n[i])),l=t.map[n[i]];if(s&&o.push({type:"txt",data:s}),l){var p=t.map?l:null;p?(a=!0,o.push({type:"emoji",data:p})):o.push({type:"txt",data:n[i]});var d=r.indexOf(n[i])+n[i].length;r=r.substring(d)}else o.push({type:"txt",data:n[i]})}return r&&o.push({type:"txt",data:r}),a?{isemoji:a,body:o}:{isemoji:!1,body:[{type:"txt",data:e}]}},ajax:function(e){var t=e.success||a,r=e.error||a,o=e.type||"POST",n=e.data||null,i="";if("get"===o.toLowerCase()&&n){for(var s in n)n.hasOwnProperty(s)&&(i+=s+"="+n[s]+"&");i=i?i.slice(0,-1):i,e.url+=(e.url.indexOf("?")>0?"&":"?")+(i?i+"&":i)+"_v="+(new Date).getTime(),n=null,i=null}console.log("wx.request",e.url),wx.request({url:e.url,data:e.data,header:e.headers,method:o,success:function(e){console.log("wx.request.success",arguments),"200"==e.statusCode?t(e):r(e)},complete:function(){console.log("wx.request.complete",arguments)},fail:function(){console.log("wx.request.fail",arguments)}})},ts:function(){var e=new Date,t=e.getHours(),r=e.getMinutes(),o=e.getSeconds();return(t<10?"0"+t:t)+":"+(r<10?"0"+r:r)+":"+(o<10?"0"+o:o)+":"+e.getMilliseconds()+" "},getObjectKey:function(e,t){for(var r in e)if(e[r]==t)return r;return""}};exports.utils=y}();
},{"./status":"63GH"}],"L7ge":[function(require,module,exports) {
var e=require("./libs/strophe");!function(){var t=require("./utils").utils,i=function e(t,i){return this instanceof e?(this._msg={},"function"==typeof e[t]&&(e[t].prototype.setGroup=this.setGroup,this._msg=new e[t](i)),this._msg):new e(t)};function o(e){if(!(this instanceof o))return new o(e);this.msg=e}i.prototype.setGroup=function(e){this.body.group=e},(i.read=function(e){this.id=e,this.type="read"}).prototype.set=function(e){this.body={ackId:e.id,to:e.to}},(i.txt=function(e){this.id=e,this.type="txt",this.body={}}).prototype.set=function(e){this.value=e.msg,this.body={id:this.id,from:e.from,to:e.to,msg:this.value,type:this.type,roomType:e.roomType,chatType:e.chatType,ext:e.ext||{},success:e.success,fail:e.fail},!e.roomType&&delete this.body.roomType},(i.cmd=function(e){this.id=e,this.type="cmd",this.body={}}).prototype.set=function(e){this.value="",this.body={to:e.to,from:e.from,action:e.action,msg:this.value,type:this.type,roomType:e.roomType,ext:e.ext||{}},!e.roomType&&delete this.body.roomType},(i.location=function(e){this.id=e,this.type="loc",this.body={}}).prototype.set=function(e){this.body={to:e.to,from:e.from,type:this.type,roomType:e.roomType,addr:e.addr,lat:e.lat,lng:e.lng,chatType:e.chatType,ext:e.ext||{}}},(i.img=function(e){this.id=e,this.type="img",this.body={}}).prototype.set=function(e){this.value=e.file,this.body={id:this.id,file:this.value,apiUrl:e.apiUrl,to:e.to,from:e.from,type:this.type,ext:e.ext||{},roomType:e.roomType,onFileUploadError:e.onFileUploadError,onFileUploadComplete:e.onFileUploadComplete,success:e.success,fail:e.fail,flashUpload:e.flashUpload,width:e.width,height:e.height,body:e.body},!e.roomType&&delete this.body.roomType},(i.audio=function(e){this.id=e,this.type="audio",this.body={}}).prototype.set=function(e){e.file=e.file||t.getFileUrl(e.fileInputId),this.value=e.file,this.filename=e.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:e.apiUrl,to:e.to,from:e.from,type:this.type,ext:e.ext||{},length:e.length||0,roomType:e.roomType,file_length:e.file_length,onFileUploadError:e.onFileUploadError,onFileUploadComplete:e.onFileUploadComplete,success:e.success,fail:e.fail,flashUpload:e.flashUpload,body:e.body},!e.roomType&&delete this.body.roomType},(i.file=function(e){this.id=e,this.type="file",this.body={}}).prototype.set=function(e){e.file=e.file||t.getFileUrl(e.fileInputId),this.value=e.file,this.filename=e.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:e.apiUrl,to:e.to,from:e.from,type:this.type,ext:e.ext||{},roomType:e.roomType,onFileUploadError:e.onFileUploadError,onFileUploadComplete:e.onFileUploadComplete,success:e.success,fail:e.fail,flashUpload:e.flashUpload,body:e.body},!e.roomType&&delete this.body.roomType},(i.video=function(e){this.id=e,this.type="file",this.body={}}).prototype.set=function(e){e.file=e.file||t.getFileUrl(e.fileInputId),this.value=e.file,this.filename=e.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:e.apiUrl,to:e.to,from:e.from,type:this.type,ext:e.ext||{},roomType:e.roomType,onFileUploadError:e.onFileUploadError,onFileUploadComplete:e.onFileUploadComplete,success:e.success,fail:e.fail,flashUpload:e.flashUpload,body:e.body},!e.roomType&&delete this.body.roomType},o.prototype.send=function(i){var o=this,s=function(o){o.ext=o.ext||{},o.ext.weichat=o.ext.weichat||{},o.ext.weichat.originType=o.ext.weichat.originType||"webim";var s={from:i.context.userId||"",to:o.to,bodies:[o.body],ext:o.ext||{}},l=t.stringify(s),p=e.$msg({type:o.group||"chat",to:o.toJid,id:o.id,xmlns:"jabber:client"}).c("body").t(l);if(o.roomType&&p.up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"}),o.bodyId){p=e.$msg({from:i.context.jid||"",to:o.toJid,id:o.id,xmlns:"jabber:client"}).c("body").t(o.bodyId);var d={xmlns:"urn:xmpp:receipts",id:o.bodyId};p.up().c("delivery",d)}if(o.ackId){if(i.context.jid.indexOf(o.toJid)>=0)return;p=e.$msg({from:i.context.jid||"",to:o.toJid,id:o.id,xmlns:"jabber:client"}).c("body").t(o.ackId);var n={xmlns:"urn:xmpp:receipts",id:o.ackId};p.up().c("acked",n)}i.sendCommand(p.tree(),o.id)};if(o.msg.file){if(o.msg.body&&o.msg.body.url)return void s(o.msg);var l=o.msg.onFileUploadComplete;o.msg.onFileUploadComplete=function(e){if(e.entities[0]["file-metadata"]){var t=e.entities[0]["file-metadata"]["content-length"];o.msg.file_length=t,o.msg.filetype=e.entities[0]["file-metadata"]["content-type"],t>204800&&(o.msg.thumbnail=!0)}o.msg.body={type:o.msg.type||"file",url:e.uri+"/"+e.entities[0].uuid,secret:e.entities[0]["share-secret"],filename:o.msg.file.filename||o.msg.filename,size:{width:o.msg.width||0,height:o.msg.height||0},length:o.msg.length||0,file_length:o.msg.file_length||0,filetype:o.msg.filetype},s(o.msg),l instanceof Function&&l(e,o.msg.id)},t.uploadFile.call(i,o.msg)}else"img"===o.msg.type?s(o.msg):(o.msg.body={type:"chat"===o.msg.type?"txt":o.msg.type,msg:o.msg.msg},"cmd"===o.msg.type?o.msg.body.action=o.msg.action:"loc"===o.msg.type&&(o.msg.body.addr=o.msg.addr,o.msg.body.lat=o.msg.lat,o.msg.body.lng=o.msg.lng),s(o.msg))},exports._msg=o,exports.message=i}();
},{"./libs/strophe":"MgtB","./utils":"FO+Z"}],"E1IZ":[function(require,module,exports) {
!function(){function r(r){this.array=void 0===r?[]:new Array(r)}r.prototype={length:function(){return this.array.length},at:function(r){return this.array[r]},set:function(r,t){this.array[r]=t},push:function(r){return this.array.push(r)},slice:function(r,t){return this.array=this.array.slice(r,t),this.array},concat:function(r){this.array=this.array.concat(r)},remove:function(r,t){t=void 0===t?1:t,this.array.splice(r,t)},join:function(r){return this.array.join(r)},clear:function(){this.array.length=0}};var t=function(){this._array_h=new r};t.prototype={_index:0,push:function(r){this._array_h.push(r)},pop:function(){var r=null;return this._array_h.length()&&(r=this._array_h.at(this._index),2*++this._index>=this._array_h.length()&&(this._array_h.slice(this._index),this._index=0)),r},head:function(){var r=null,t=this._array_h.length();return t&&(r=this._array_h.at(t-1)),r},tail:function(){var r=null;return this._array_h.length()&&(r=this._array_h.at(this._index)),r},length:function(){return this._array_h.length()-this._index},empty:function(){return 0===this._array_h.length()},clear:function(){this._array_h.clear()}},exports.Queue=t}();
},{}],"DXTH":[function(require,module,exports) {
"use strict";var _strophe=_interopRequireDefault(require("./libs/strophe"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var WebIM={},Strophe=_strophe.default.Strophe;Strophe.log=function(e,t){};var xmldom=require("./libs/xmldom/dom-parser"),DOMParser=xmldom.DOMParser,window={},_version="1.1.3",_code=require("./status").code,_utils=require("./utils").utils,_msg=require("./message"),_message=_msg._msg,_msgHash={},Queue=require("./queue").Queue,location=window.location||{protocol:"https:"};function _listenNetwork(e,t){window.addEventListener?(window.addEventListener("online",e),window.addEventListener("offline",t)):window.attachEvent&&(document.body?(document.body.attachEvent("ononline",e),document.body.attachEvent("onoffline",t)):window.attachEvent("load",function(){document.body.attachEvent("ononline",e),document.body.attachEvent("onoffline",t)}))}function _parseRoom(e){var t=[],o=e.getElementsByTagName("item");if(o)for(var n=0;n<o.length;n++){var r=o[n],i=r.getAttribute("jid"),s=i.split("@")[0],a={jid:i,name:r.getAttribute("name"),roomId:s.split("_")[1]};t.push(a)}return t}function _parseRoomOccupants(e){var t=[],o=e.getElementsByTagName("item");if(o)for(var n=0;n<o.length;n++){var r=o[n],i={jid:r.getAttribute("jid"),name:r.getAttribute("name")};t.push(i)}return t}function _parseResponseMessage(msginfo){var parseMsgData={errorMsg:!0,data:[]},msgBodies=msginfo.getElementsByTagName("body");if(msgBodies){for(var i=0;i<msgBodies.length;i++){var msgBody=msgBodies[i],childNodes=msgBody.childNodes;if(childNodes&&childNodes.length>0){var childNode=msgBody.childNodes[0];if(childNode.nodeType==Strophe.ElementType.TEXT){var jsondata=childNode.wholeText||childNode.nodeValue;jsondata=jsondata.replace("\n","<br>");try{var data=JSON.parse(jsondata);parseMsgData.errorMsg=!1,parseMsgData.data=[data]}catch(e){}}}}var delayTags=msginfo.getElementsByTagName("delay");if(delayTags&&delayTags.length>0){var delayTag=delayTags[0],delayMsgTime=delayTag.getAttribute("stamp");delayMsgTime&&(parseMsgData.delayTimeStamp=delayMsgTime)}}else{var childrens=msginfo.childNodes;if(childrens&&childrens.length>0){var child=msginfo.childNodes[0];if(child.nodeType==Strophe.ElementType.TEXT)try{var _data=eval("("+child.nodeValue+")");parseMsgData.errorMsg=!1,parseMsgData.data=[_data]}catch(e){}}}return parseMsgData}function _parseNameFromJidFn(e,t){var o=e,n=o.indexOf("_");t=t||"",-1!==n&&(o=o.substring(n+1));var r=o.indexOf("@"+t);return-1!==r&&(o=o.substring(0,r)),o}function _parseFriend(e,t,o){var n=[],r=e.getElementsByTagName("item");if(r)for(var i=function(e){var o=[],i=r[e],s=i.getAttribute("jid");if(!s)return"continue";var a=i.getAttribute("subscription"),c={subscription:a,jid:s},p=i.getAttribute("ask");p&&(c.ask=p);var u=i.getAttribute("name");c.name=u||_parseNameFromJidFn(s),Strophe.forEachChild(i,"group",function(e){o.push(Strophe.getText(e))}),c.groups=o,n.push(c),t&&"from"==a&&t.subscribe({toJid:s}),t&&"to"==a&&t.subscribed({toJid:s})},s=0;s<r.length;s++)i(s);return n}function _parseMessageType(e){var t="normal",o=e.getElementsByTagName("received");if(o&&o.length>0&&"urn:xmpp:receipts"===o[0].namespaceURI)t="received";else{var n=e.getElementsByTagName("invite");n&&n.length>0&&(t="invite")}return t}function _handleMessageQueue(e){for(var t in _msgHash)Object.hasOwnProperty.call(_msgHash,t)&&_msgHash[t].send(e)}function _loginCallback(e,t,o){var n,r="conflict"===t;if(e==Strophe.Status.CONNFAIL)console.log("链接失败"),n={type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:t},r&&(n.conflict=!0),o.onError(n);else if(e==Strophe.Status.ATTACHED||e==Strophe.Status.CONNECTED){console.log("链接成功"),o.autoReconnectNumTotal=0,o.intervalId=setInterval(function(){o.handelSendQueue()},200);o.addHandler(function(e){var t=_parseMessageType(e);return"received"===t?(o.handleReceivedMessage(e),!0):"invite"===t?(o.handleInviteMessage(e),!0):(o.handleMessage(e),!0)},null,"message",null,null,null),o.addHandler(function(e){return o.handlePresence(e),!0},null,"presence",null,null,null),o.addHandler(function(e){return o.handleIqRoster(e),!0},"jabber:iq:roster","iq","set",null,null),o.addHandler(function(e){return o.handleIqPrivacy(e),!0},"jabber:iq:privacy","iq","set",null,null),o.addHandler(function(e){return o.handleIq(e),!0},null,"iq",null,null,null),o.context.status=_code.STATUS_OPENED;var i=[_code.WEBIM_MESSAGE_REC_TEXT,_code.WEBIM_MESSAGE_REC_EMOJI],s=[_code.WEBIM_MESSAGE_SED_TEXT];_utils.isCanDownLoadFile&&(i.push(_code.WEBIM_MESSAGE_REC_PHOTO),i.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE)),_utils.isCanUploadFile&&(s.push(_code.WEBIM_MESSAGE_REC_PHOTO),s.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE)),o.notifyVersion(),o.retry&&_handleMessageQueue(o),o.heartBeat(),o.isAutoLogin&&o.setPresence(),o.onOpened({canReceive:i,canSend:s,accessToken:o.context.accessToken})}else e==Strophe.Status.DISCONNECTING?(console.log(33333),o.isOpened()&&(n={type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:t},r&&(n.conflict=!0),o.onError(n)),o.context.status=_code.STATUS_CLOSING):e==Strophe.Status.DISCONNECTED?(o.isOpened()&&(n={type:_code.WEBIM_CONNCTION_DISCONNECTED},o.onError(n)),o.context.status=_code.STATUS_CLOSED,o.clear(),o.onClosed()):e==Strophe.Status.AUTHFAIL?(console.log("授权失败"),n={type:_code.WEBIM_CONNCTION_AUTH_ERROR},r&&(n.conflict=!0),o.onError(n),o.clear(),wx.closeSocket()):e==Strophe.Status.ERROR&&(o.context.status=_code.STATUS_ERROR,n={type:_code.WEBIM_CONNCTION_SERVER_ERROR},r&&(n.conflict=!0),o.onError(n))}function _login(e,t){var o=null,n=e.access_token||"";function r(e,o){console.log("connection stat change",e,o),_loginCallback(e,o,t)}""!=n?(t.context.accessToken=e.access_token,t.context.accessTokenExpires=e.expires_in,o=new Strophe.Connection(t.url,{inactivity:t.inactivity,maxRetries:t.maxRetries,pollingTime:t.pollingTime}),t.context.stropheConn=o,t.route?o.connect(t.context.jid,"$t$"+n,r,t.wait,t.hold,t.route):o.connect(t.context.jid,"$t$"+n,r,t.wait,t.hold)):t.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:e})}function _getJid(e,t){var o=e.toJid||"";if(""===o){var n=(t.context.appKey||"")+"_"+e.to+"@"+t.domain;e.resource&&(n=n+"/"+e.resource),o=n}return o}function _getJidByName(e,t){return _getJid({to:e},t)}function _validCheck(e,t){if(""==(e=e||{}).user)return t.onError({type:_code.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR}),!1;var o=e.user+""||"",n=e.appKey||"",r=n.split("#");if(2!==r.length)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var i=r[0],s=r[1];if(!i)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;if(!s)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var a=n+"_"+o.toLowerCase()+"@"+t.domain,c=e.resource||"webim";return t.isMultiLoginSessions&&(c+=o+(new Date).getTime()+Math.floor(1e6*Math.random().toFixed(6))),t.context.jid=a+"/"+c,t.context.userId=o,t.context.appKey=n,t.context.appName=s,t.context.orgName=i,!0}function _getXmppUrl(e,t){if(/^(ws|http)s?:\/\/?/.test(e))return e;var o={prefix:"http",base:"://"+e,suffix:"/http-bind/"};return t&&_utils.isSupportWss?(o.prefix="wss",o.suffix="/ws/"):t?o.prefix="https":window.WebSocket&&(o.prefix="ws",o.suffix="/ws/"),o.prefix+o.base+o.suffix}function connection(e){if(!(this instanceof connection))return new connection(e);e=e||{},this.isMultiLoginSessions=e.isMultiLoginSessions||!1,this.wait=e.wait||30,this.retry=e.retry||!1,this.https=e.https||"https:"===location.protocol,this.url=_getXmppUrl(e.url,this.https),this.hold=e.hold||1,this.route=e.route||null,this.domain=e.domain||"easemob.com",this.inactivity=e.inactivity||30,this.heartBeatWait=e.heartBeatWait||4500,this.maxRetries=e.maxRetries||5,this.isAutoLogin=!1!==e.isAutoLogin,this.pollingTime=e.pollingTime||800,this.stropheConn=!1,this.autoReconnectNumMax=e.autoReconnectNumMax||0,this.autoReconnectNumTotal=0,this.autoReconnectInterval=e.autoReconnectInterval||0,this.context={status:_code.STATUS_INIT},this.apiUrl=e.apiUrl||"",this.sendQueue=new Queue,this.intervalId=null,this.orgName="",this.appName="",this.token=""}function _parsePrivacy(e){var t=[],o=e.getElementsByTagName("item");if(o)for(var n=0;n<o.length;n++){var r=o[n],i=r.getAttribute("value"),s=r.getAttribute("order"),a=r.getAttribute("type");if(i){var c=_parseNameFromJidFn(i);t[c]={type:a,order:s,jid:i,name:c}}}return t}window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,window.XDomainRequest&&(XDomainRequest.prototype.oldsend=XDomainRequest.prototype.send,XDomainRequest.prototype.send=function(){XDomainRequest.prototype.oldsend.apply(this,arguments),this.readyState=2}),Strophe.Request.prototype._newXHR=function(){var e=_utils.xmlrequest(!0);return e.overrideMimeType&&e.overrideMimeType("text/xml"),e.onreadystatechange=this.func.bind(null,this),e},Strophe.Websocket.prototype._onSocketClose=function(e){},Strophe.Websocket.prototype._onMessage=function(e){var t,o;try{WebIM&&WebIM.config.isDebug&&(console.group("%crecv # ","color: green; font-size: large"),console.log("%c"+e.data,"color: green"),console.groupEnd())}catch(r){}if(0!==e.data.indexOf("<close ")){if(0===e.data.search("<open ")){if(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else o=this._streamWrap(e.data),t=(new DOMParser).parseFromString(o,"text/xml").documentElement;if(!this._check_streamerror(t,Strophe.Status.ERROR))return this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(Strophe.serialize(t))):void this._conn._dataRecv(t,e.data)}else{var n=(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement).getAttribute("see-other-uri");n?(this._conn._changeConnectStatus(Strophe.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=n,this._connect()):this._conn._doDisconnect("receive <close> from server")}},connection.prototype.handelSendQueue=function(){var e=this.sendQueue.pop();null!==e&&this.sendReceiptsMessage(e)},connection.prototype.listen=function(e){e.url&&(this.url=_getXmppUrl(e.url,this.https)),this.onOpened=e.onOpened||_utils.emptyfn,this.onClosed=e.onClosed||_utils.emptyfn,this.onTextMessage=e.onTextMessage||_utils.emptyfn,this.onEmojiMessage=e.onEmojiMessage||_utils.emptyfn,this.onPictureMessage=e.onPictureMessage||_utils.emptyfn,this.onAudioMessage=e.onAudioMessage||_utils.emptyfn,this.onVideoMessage=e.onVideoMessage||_utils.emptyfn,this.onFileMessage=e.onFileMessage||_utils.emptyfn,this.onLocationMessage=e.onLocationMessage||_utils.emptyfn,this.onCmdMessage=e.onCmdMessage||_utils.emptyfn,this.onPresence=e.onPresence||_utils.emptyfn,this.onRoster=e.onRoster||_utils.emptyfn,this.onError=e.onError||_utils.emptyfn,this.onReceivedMessage=e.onReceivedMessage||_utils.emptyfn,this.onInviteMessage=e.onInviteMessage||_utils.emptyfn,this.onOffline=e.onOffline||_utils.emptyfn,this.onOnline=e.onOnline||_utils.emptyfn,this.onConfirmPop=e.onConfirmPop||_utils.emptyfn,this.onCreateGroup=e.onCreateGroup||_utils.emptyfn,this.onUpdateMyGroupList=e.onUpdateMyGroupList||_utils.emptyfn,this.onUpdateMyRoster=e.onUpdateMyRoster||_utils.emptyfn,this.onBlacklistUpdate=e.onBlacklistUpdate||_utils.emptyfn,_listenNetwork(this.onOnline,this.onOffline)},connection.prototype.heartBeatID=0,connection.prototype.heartBeat=function(){var e=this;this.stopHeartBeat(),this.heartBeatID=setInterval(function(){e.ping({toJid:e.domain,type:"normal"})},this.heartBeatWait)},connection.prototype.stopHeartBeat=function(){clearInterval(this.heartBeatID)},connection.prototype.sendReceiptsMessage=function(e){var t=_strophe.default.$msg({from:this.context.jid||"",to:this.domain,id:e.id||""}).c("received",{xmlns:"urn:xmpp:receipts",id:e.id||""});this.sendCommand(t.tree())},connection.prototype.cacheReceiptsMessage=function(e){this.sendQueue.push(e)},connection.prototype.open=function(e){var t=this;if(console.log("open",this.isOpening()),this.isOpening()||this.isOpened())console.log("can't open [1]");else if(_validCheck(e,this))if(e.accessToken)e.access_token=e.accessToken,this.token=e.access_token,_login(e,t);else{var o=e.apiUrl,n=e.user,r=e.pwd||"",i=e.appKey.split("#"),s=i[0],a=i[1];this.orgName=s,this.appName=a,this.context.status=_code.STATUS_DOLOGIN_USERGRID;var c={grant_type:"password",username:n,password:r,timestamp:+new Date},p=_utils.stringify(c);_utils.ajax({url:o+"/"+s+"/"+a+"/token",data:p,success:function(e,o,n){t.context.status=_code.STATUS_DOLOGIN_IM,t.context.restTokenData=e,"404"!=e.statusCode&&"400"!=e.statusCode?_login(e.data,t):u({})}||_utils.emptyfn,error:u||_utils.emptyfn})}else console.log("can't open [2]");function u(e,o,n){t.clear(),e.error&&e.error_description?t.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:e,xhr:o}):t.onError({type:_code.WEBIM_CONNCTION_OPEN_ERROR,data:e,xhr:o})}},connection.prototype.attach=function(e){var t=this;if(_validCheck(e,this)){var o=(e=e||{}).accessToken||"";if(""!=o){var n=e.sid||"";if(""!==n){var r=e.rid||"";if(""!==r){var i=new Strophe.Connection(this.url,{inactivity:this.inactivity,maxRetries:this.maxRetries,pollingTime:this.pollingTime,heartBeatWait:this.heartBeatWait});this.context.accessToken=o,this.context.stropheConn=i,this.context.status=_code.STATUS_DOLOGIN_IM;var s=this.context.jid,a=this.wait,c=this.hold,p=this.wind||5;i.attach(s,n,r,function(e,o){_loginCallback(e,o,t)},a,c,p)}else this.onError({type:_code.WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR})}else this.onError({type:_code.WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR})}else this.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR})}},connection.prototype.close=function(e){this.context.status!=_code.STATUS_INIT&&(this.isClosed()||this.isClosing()||(this.context.status=_code.STATUS_CLOSING,this.context.stropheConn.disconnect(e)))},connection.prototype.addHandler=function(e,t,o,n,r,i,s){this.context.stropheConn.addHandler(e,t,o,n,r,i,s)},connection.prototype.notifyVersion=function(e,t){var o=_strophe.default.$iq({from:this.context.jid||"",to:this.domain,type:"result"}).c("query",{xmlns:"jabber:iq:version"}).c("name").t("easemob").up().c("version").t(_version).up().c("os").t("webim");e=e||_utils.emptyfn;var n=t||this.onError;this.context.stropheConn.sendIQ(o.tree(),e,function(e){n({type:_code.WEBIM_CONNCTION_NOTIFYVERSION_ERROR,data:e})})},connection.prototype.handlePresence=function(e){if(!this.isClosed()){var t=e.getAttribute("from")||"",o=e.getAttribute("to")||"",n=e.getAttribute("type")||"",r=e.getAttribute("presence_type")||"",i=!1,s=!1,a=!1,c=!1,p={from:_parseNameFromJidFn(t),to:_parseNameFromJidFn(o),fromJid:t,toJid:o,type:n,chatroom:!!e.getElementsByTagName("roomtype").length},u=e.getElementsByTagName("show");if(u&&u.length>0){var l=u[0];p.show=Strophe.getText(l)}var d=e.getElementsByTagName("status");if(d&&d.length>0){var m=d[0];p.status=Strophe.getText(m),p.code=m.getAttribute("code")}var h=e.getElementsByTagName("priority");if(h&&h.length>0){var _=h[0];p.priority=Strophe.getText(_)}var f=e.getElementsByTagName("error");f&&f.length>0&&(f=f[0],p.error={code:f.getAttribute("code")});var g=e.getElementsByTagName("destroy");if(g&&g.length>0){g=g[0],p.destroy=!0;var y=g.getElementsByTagName("reason");y&&y.length>0&&(p.reason=Strophe.getText(y[0]))}var N=e.getElementsByTagName("item");if(N&&N.length>0){var v=N[0],E=v.getAttribute("role"),T=v.getAttribute("jid"),I=v.getAttribute("affiliation");if("none"==E&&T){var b=_parseNameFromJidFn(T),C=v.getElementsByTagName("actor")[0].getAttribute("nick");p.actor=C,p.kicked=b}"moderator"==E&&"201"==p.code&&"owner"===I&&(p.type="createGroupACK",i=!0)}var O=e.getElementsByTagName("x");if(O&&O.length>0){var x=O[0].getElementsByTagName("apply"),R=O[0].getElementsByTagName("accept"),S=O[0].getElementsByTagName("item"),M=O[0].getElementsByTagName("decline"),A=O[0].getElementsByTagName("add_admin"),B=O[0].getElementsByTagName("remove_admin"),w=O[0].getElementsByTagName("add_mute"),j=O[0].getElementsByTagName("remove_mute");if(x&&x.length>0){c=!0,p.toNick=x[0].getAttribute("toNick"),p.type="joinGroupNotifications";var q=x[0].getAttribute("to").split("@")[0].split("_");q=q[q.length-1],p.gid=q}else if(R&&R.length>0)p.type="joinPublicGroupSuccess";else if(S&&S.length>0){var k=S[0].getAttribute("affiliation"),G=S[0].getAttribute("role");if("member"==k||"participant"==G){s=!0,p.mid=p.fromJid.split("/"),p.mid=p.mid[p.mid.length-1],p.type="memberJoinPublicGroupSuccess";var W=e.getElementsByTagName("roomtype");if(W&&W.length>0)"chatroom"==W[0].getAttribute("type")&&(p.type="memberJoinChatRoomSuccess")}else if("none"==k||"none"==G){var D=e.getElementsByTagName("roomtype");if(D&&D.length>0)"chatroom"==D[0].getAttribute("type")&&(p.type="memberLeaveChatRoomSuccess")}}else if(M&&M.length){a=!0;var U=M[0].getAttribute("fromNick"),F=_parseNameFromJidFn(M[0].getAttribute("from"));p.type="joinPublicGroupDeclined",p.owner=F,p.gid=U}else if(A&&A.length>0){var L=_parseNameFromJidFn(A[0].getAttribute("mucjid")),J=_parseNameFromJidFn(A[0].getAttribute("from"));p.owner=J,p.gid=L,p.type="addAdmin"}else if(B&&B.length>0){var P=_parseNameFromJidFn(B[0].getAttribute("mucjid")),Q=_parseNameFromJidFn(B[0].getAttribute("from"));p.owner=Q,p.gid=P,p.type="removeAdmin"}else if(w&&w.length>0){var $=_parseNameFromJidFn(w[0].getAttribute("mucjid")),H=_parseNameFromJidFn(w[0].getAttribute("from"));p.owner=H,p.gid=$,p.type="addMute"}else if(j&&j.length>0){var K=_parseNameFromJidFn(j[0].getAttribute("mucjid")),z=_parseNameFromJidFn(j[0].getAttribute("from"));p.owner=z,p.gid=K,p.type="removeMute"}}if(p.chatroom)p.presence_type=r,p.original_type=p.type,t.slice(t.lastIndexOf("/")+1)===this.context.userId&&(""!==p.type||p.code?"unavailable"!==r&&"unavailable"!==p.type||(p.status?110==p.code?p.type="leaveChatRoom":p.error&&406==p.error.code&&(p.type="reachChatRoomCapacity"):p.type="leaveChatRoom"):p.type="joinChatRoomSuccess");else if(p.presence_type=r,p.original_type=n,/subscribe/.test(p.type));else if(""!=n||p.status||p.error||i||c||s||a){if("unavailable"===r||"unavailable"===n)if(p.destroy)p.type="deleteGroupChat";else if(307==p.code||321==p.code){var V=e.getAttribute("nick");p.type=V?"removedFromGroup":"leaveGroup"}}else;this.onPresence(p,e)}},connection.prototype.handleIq=function(e){return!0},connection.prototype.handleIqPrivacy=function(e){0!=e.getElementsByTagName("list").length&&this.getBlacklist()},connection.prototype.handleIqRoster=function(e){var t=e.getAttribute("id"),o=e.getAttribute("from")||"",n=this.context.jid,r=_strophe.default.$iq({type:"result",id:t,from:n});this.sendCommand(r.tree());var i=e.getElementsByTagName("query");if(i&&i.length>0){var s=_parseFriend(i[0],this,o);this.onRoster(s)}return!0},connection.prototype.handleMessage=function(e){if(!this.isClosed()){var t=e.getAttribute("id")||"";this.cacheReceiptsMessage({id:t});var o=_parseResponseMessage(e);if(o.errorMsg)this.handlePresence(e);else{var n=e.getElementsByTagName("error"),r="",i="",s=!1;if(n.length>0){s=!0,r=n[0].getAttribute("code");var a=n[0].getElementsByTagName("text");i=a[0].textContent||a[0].text}var c=o.data;for(var p in c)if(Object.hasOwnProperty.call(c,p)){var u=c[p];if(u.from&&u.to){var l=(u.from+"").toLowerCase(),d=(u.to+"").toLowerCase(),m=u.ext||{},h="",_=e.getElementsByTagName("roomtype");h=_.length?_[0].getAttribute("type")||"chat":e.getAttribute("type")||"chat";var f=u.bodies;if(f&&0!=f.length){var g=u.bodies[0],y=g.type;try{switch(y){case"txt":var N=g.msg,v=_utils.parseTextMessage(N,WebIM.Emoji);if(v.isemoji){var E={id:t,type:h,from:l,to:d,delay:o.delayTimeStamp,data:v.body,ext:m};!E.delay&&delete E.delay,E.error=s,E.errorText=i,E.errorCode=r,this.onEmojiMessage(E)}else{var T={id:t,type:h,from:l,to:d,delay:o.delayTimeStamp,data:N,ext:m};!T.delay&&delete T.delay,T.error=s,T.errorText=i,T.errorCode=r,this.onTextMessage(T)}break;case"img":var I=0,b=0;g.size&&(I=g.size.width,b=g.size.height);var C={id:t,type:h,from:l,to:d,url:g.url,secret:g.secret,filename:g.filename,thumb:g.thumb,thumb_secret:g.thumb_secret,file_length:g.file_length||"",width:I,height:b,filetype:g.filetype||"",accessToken:this.context.accessToken||"",ext:m,delay:o.delayTimeStamp};!C.delay&&delete C.delay,C.error=s,C.errorText=i,C.errorCode=r,this.onPictureMessage(C);break;case"audio":!(C={id:t,type:h,from:l,to:d,url:g.url,secret:g.secret,filename:g.filename,length:g.length||"",file_length:g.file_length||"",filetype:g.filetype||"",accessToken:this.context.accessToken||"",ext:m,delay:o.delayTimeStamp}).delay&&delete C.delay,C.error=s,C.errorText=i,C.errorCode=r,this.onAudioMessage(C);break;case"file":!(C={id:t,type:h,from:l,to:d,url:g.url,secret:g.secret,filename:g.filename,file_length:g.file_length,accessToken:this.context.accessToken||"",ext:m,delay:o.delayTimeStamp}).delay&&delete C.delay,C.error=s,C.errorText=i,C.errorCode=r,this.onFileMessage(C);break;case"loc":!(C={id:t,type:h,from:l,to:d,addr:g.addr,lat:g.lat,lng:g.lng,ext:m,delay:o.delayTimeStamp}).delay&&delete C.delay,C.error=s,C.errorText=i,C.errorCode=r,this.onLocationMessage(C);break;case"video":!(C={id:t,type:h,from:l,to:d,url:g.url,secret:g.secret,filename:g.filename,file_length:g.file_length,accessToken:this.context.accessToken||"",ext:m,delay:o.delayTimeStamp}).delay&&delete C.delay,C.error=s,C.errorText=i,C.errorCode=r,this.onVideoMessage(C);break;case"cmd":!(C={id:t,from:l,to:d,action:g.action,ext:m,delay:o.delayTimeStamp}).delay&&delete C.delay,C.error=s,C.errorText=i,C.errorCode=r,this.onCmdMessage(C)}}catch(O){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:O})}}}}}}},connection.prototype.handleReceivedMessage=function(e){try{this.onReceivedMessage(e)}catch(r){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:r})}var t,o,n=e.getElementsByTagName("received");if(n.length>0&&(t=n[0].childNodes&&n[0].childNodes.length>0?n[0].childNodes[0].nodeValue:n[0].innerHTML||n[0].innerText,o=n[0].getAttribute("mid")),_msgHash[t]){try{_msgHash[t].msg.success instanceof Function&&_msgHash[t].msg.success(t,o)}catch(r){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:r})}delete _msgHash[t]}},connection.prototype.handleInviteMessage=function(e){var t=null,o=e.getElementsByTagName("invite"),n=e.getElementsByTagName("reason")[0].textContent,r=e.getAttribute("id")||"";(this.sendReceiptsMessage({id:r}),o&&o.length>0)&&(t=_parseNameFromJidFn(o[0].getAttribute("from")));var i=e.getElementsByTagName("x"),s=null;if(i&&i.length>0)for(var a=0;a<i.length;a++){if("jabber:x:conference"===i[a].namespaceURI)s=_parseNameFromJidFn(i[a].getAttribute("jid"))}this.onInviteMessage({type:"invite",from:t,roomid:s,reason:n})},connection.prototype.sendCommand=function(e,t){this.isOpened()?this.context.stropheConn.send(e):this.onError({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.getUniqueId=function(e){var t=new Date,o=new Date(2010,1,1),n=t.getTime()-o.getTime(),r=parseInt(n).toString(16);return"string"==typeof e||"number"==typeof e?e+"_"+r:"WEBIM_"+r},connection.prototype.send=function(e){if(WebIM.config.isWindowSDK)WebIM.doQuery(JSON.stringify({type:"sendMessage",to:e.to,message_type:e.type,msg:encodeURI(e.msg),chatType:e.chatType}),function(e){},function(e,t){});else if("[object Object]"===Object.prototype.toString.call(e)){var t=this.context.appKey||"",o=t+"_"+e.to+"@"+this.domain;e.group&&(o=t+"_"+e.to+"@conference."+this.domain),e.resource&&(o=o+"/"+e.resource),e.toJid=o,e.id=e.id||this.getUniqueId(),_msgHash[e.id]=new _message(e),_msgHash[e.id].send(this)}else"string"==typeof e&&_msgHash[e]&&_msgHash[e].send(this)},connection.prototype.addRoster=function(e){var t=_getJid(e,this),o=e.name||"",n=e.groups||"",r=_strophe.default.$iq({type:"set"});if(r.c("query",{xmlns:"jabber:iq:roster"}),r.c("item",{jid:t,name:o}),n)for(var i=0;i<n.length;i++)r.c("group").t(n[i]).up();var s=e.success||_utils.emptyfn,a=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(r.tree(),s,a)},connection.prototype.removeRoster=function(e){var t=_getJid(e,this),o=_strophe.default.$iq({type:"set"}).c("query",{xmlns:"jabber:iq:roster"}).c("item",{jid:t,subscription:"remove"}),n=e.success||_utils.emptyfn,r=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(o,n,r)},connection.prototype.getRoster=function(e){var t=_strophe.default.$iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"}),o=(e=e||{}).success||this.onRoster,n=e.error||this.onError;this.isOpened()?this.context.stropheConn.sendIQ(t.tree(),function(e){var t=[],n=e.getElementsByTagName("query");n&&n.length>0&&(t=_parseFriend(n[0]));o(t,e)},function(e){n({type:_code.WEBIM_CONNCTION_GETROSTER_ERROR,data:e})}):n({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.subscribe=function(e){var t=_getJid(e,this),o=_strophe.default.$pres({to:t,type:"subscribe"});e.message&&o.c("status").t(e.message).up(),e.nick&&o.c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(e.nick),this.sendCommand(o.tree())},connection.prototype.subscribed=function(e){var t=_getJid(e,this),o=_strophe.default.$pres({to:t,type:"subscribed"});e.message&&o.c("status").t(e.message).up(),this.sendCommand(o.tree())},connection.prototype.unsubscribe=function(e){var t=_getJid(e,this),o=_strophe.default.$pres({to:t,type:"unsubscribe"});e.message&&o.c("status").t(e.message),this.sendCommand(o.tree())},connection.prototype.unsubscribed=function(e){var t=_getJid(e,this),o=_strophe.default.$pres({to:t,type:"unsubscribed"});e.message&&o.c("status").t(e.message).up(),this.sendCommand(o.tree())},connection.prototype.createRoom=function(e){var t,o=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn;return t=_strophe.default.$iq({to:e.roomName,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),this.context.stropheConn.sendIQ(t.tree(),o,n)},connection.prototype.listRooms=function(e){var t=_strophe.default.$iq({to:e.server||"conference."+this.domain,from:this.context.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS}),o=e.success||_utils.emptyfn,n=e.error||this.onError,r=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(t.tree(),function(e){var t;t=_parseRoom(e);try{o(t)}catch(r){n({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:r})}},function(e){r({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:e})})},connection.prototype.queryRoomMember=function(e){var t=[],o=_strophe.default.$iq({to:this.context.appKey+"_"+e.roomId+"@conference."+this.domain,type:"get"}).c("query",{xmlns:Strophe.NS.MUC+"#admin"}).c("item",{affiliation:"member"}),n=e.success||_utils.emptyfn,r=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(o.tree(),function(e){var o=e.getElementsByTagName("item");if(o)for(var r=0;r<o.length;r++){var i={jid:o[r].getAttribute("jid"),affiliation:"member"};t.push(i)}n(t)},function(e){r({type:_code.WEBIM_CONNCTION_GETROOMMEMBER_ERROR,data:e})})},connection.prototype.queryRoomInfo=function(e){var t=this.domain,o=_strophe.default.$iq({to:this.context.appKey+"_"+e.roomId+"@conference."+t,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_INFO}),n=e.success||_utils.emptyfn,r=[],i=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(o.tree(),function(e){var o="",i=e.getElementsByTagName("feature");switch(i&&(o=i[1].getAttribute("var")+"|"+i[3].getAttribute("var")+"|"+i[4].getAttribute("var")),o){case"muc_public|muc_membersonly|muc_notallowinvites":o="PUBLIC_JOIN_APPROVAL";break;case"muc_public|muc_open|muc_notallowinvites":o="PUBLIC_JOIN_OPEN";break;case"muc_hidden|muc_membersonly|muc_allowinvites":o="PRIVATE_MEMBER_INVITE";break;case"muc_hidden|muc_membersonly|muc_notallowinvites":o="PRIVATE_OWNER_INVITE"}var s=e.getElementsByTagName("field"),a={};if(s){for(var c=0;c<s.length;c++){var p=s[c],u=p.getAttribute("var"),l=u.split("_")[1];switch(u){case"muc#roominfo_occupants":case"muc#roominfo_maxusers":case"muc#roominfo_affiliations":case"muc#roominfo_description":a[l]=p.textContent||p.text||"";break;case"muc#roominfo_owner":var d={jid:(p.textContent||p.text)+"@"+t,affiliation:"owner"};r.push(d),a[l]=p.textContent||p.text}}a.name=e.getElementsByTagName("identity")[0].getAttribute("name")}n(o,r,a)},function(e){i({type:_code.WEBIM_CONNCTION_GETROOMINFO_ERROR,data:e})})},connection.prototype.queryRoomOccupants=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n={xmlns:Strophe.NS.DISCO_ITEMS},r=_strophe.default.$iq({from:this.context.jid,to:this.context.appKey+"_"+e.roomId+"@conference."+this.domain,type:"get"}).c("query",n);this.context.stropheConn.sendIQ(r.tree(),function(e){var o;o=_parseRoomOccupants(e),t(o)},function(e){o({type:_code.WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR,data:e})})},connection.prototype.setUserSig=function(e){var t=_strophe.default.$pres({xmlns:"jabber:client"});e=e||"",t.c("status").t(e),this.sendCommand(t.tree())},connection.prototype.setPresence=function(e,t){var o=_strophe.default.$pres({xmlns:"jabber:client"});e&&(t?(o.c("show").t(e),o.up().c("status").t(t)):o.c("show").t(e)),this.sendCommand(o.tree())},connection.prototype.getPresence=function(){var e=_strophe.default.$pres({xmlns:"jabber:client"});this.sendCommand(e.tree())},connection.prototype.ping=function(e){var t=_getJid(e=e||{},this),o=_strophe.default.$iq({from:this.context.jid||"",to:t,type:"get"}).c("ping",{xmlns:"urn:xmpp:ping"}),n=e.success||_utils.emptyfn,r=e.error||this.onError;this.isOpened()?this.context.stropheConn.sendIQ(o.tree(),n,function(e){r({type:_code.WEBIM_CONNCTION_PING_ERROR,data:e})}):r({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.isOpened=function(){return this.context.status==_code.STATUS_OPENED},connection.prototype.isOpening=function(){var e=this.context.status;return e==_code.STATUS_DOLOGIN_USERGRID||e==_code.STATUS_DOLOGIN_IM},connection.prototype.isClosing=function(){return this.context.status==_code.STATUS_CLOSING},connection.prototype.isClosed=function(){return this.context.status==_code.STATUS_CLOSED},connection.prototype.clear=function(){var e=this.context.appKey;this.errorType!=WebIM.statusCode.WEBIM_CONNCTION_DISCONNECTED&&(this.context={status:_code.STATUS_INIT,appKey:e}),this.intervalId&&clearInterval(this.intervalId),this.errorType==WebIM.statusCode.WEBIM_CONNCTION_CLIENT_LOGOUT||this.errorType},connection.prototype.getChatRooms=function(e){var t=this,o=e.accessToken||this.context.accessToken;if(o){var n=this.apiUrl,r=this.context.appName,i=this.context.orgName;if(!r||!i)return void t.onError({type:_code.WEBIM_CONNCTION_AUTH_ERROR});var s={url:n+"/"+i+"/"+r+"/chatrooms",dataType:"json",type:"GET",header:{Authorization:"Bearer "+o},data:{pagenum:parseInt(e.pagenum)||1,pagesize:parseInt(e.pagesize)||20},success:function(t,o){"function"==typeof e.success&&e.success(t)}||_utils.emptyfn,fail:function(e,o,n){e.error&&e.error_description&&t.onError({type:_code.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR,msg:e.error_description,data:e,xhr:o})}||_utils.emptyfn};wx.request(s)}else t.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR})},connection.prototype.joinChatRoom=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain+"/"+this.context.userId,o=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,r=_strophe.default.$pres({from:this.context.jid,to:t});r.c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"member",role:"participant"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"}),this.context.stropheConn.sendIQ(r.tree(),o,function(e){n({type:_code.WEBIM_CONNCTION_JOINCHATROOM_ERROR,data:e})})},connection.prototype.quitChatRoom=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain+"/"+this.context.userId,o=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,r=_strophe.default.$pres({from:this.context.jid,to:t,type:"unavailable"});r.c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"none",role:"none"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"}),this.context.stropheConn.sendIQ(r.tree(),o,function(e){n({type:_code.WEBIM_CONNCTION_QUITCHATROOM_ERROR,data:e})})},connection.prototype._onUpdateMyGroupList=function(e){this.onUpdateMyGroupList(e)},connection.prototype._onUpdateMyRoster=function(e){this.onUpdateMyRoster(e)},connection.prototype.listGroupMember=function(e){if(isNaN(e.pageNum)||e.pageNum<=0)throw new Error('The parameter "pageNum" should be a positive number');if(isNaN(e.pageSize)||e.pageSize<=0)throw new Error('The parameter "pageSize" should be a positive number');if(null===e.groupId&&void 0===e.groupId)throw new Error('The parameter "groupId" should be added');var t=[],o=e.groupId;t.pagenum=e.pageNum,t.pagesize=e.pageSize;var n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+o+"/users",dataType:"json",type:"GET",data:t,headers:{Authorization:"Bearer "+this.context.accessToken,"Content-Type":"application/json"}};n.success=e.success||_utils.emptyfn,n.error=e.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.createGroupNew=function(e){e.data.invite_need_confirm=!1;var t={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups",dataType:"json",type:"POST",data:JSON.stringify(e.data),headers:{Authorization:"Bearer "+this.context.accessToken,"Content-Type":"application/json"}};t.success=function(t){e.success(t),this.onCreateGroup(t)}.bind(this),t.error=e.error||_utils.emptyfn,WebIM.utils.ajax(t)},connection.prototype.getGroupInfo=function(e){var t={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e.groupId,type:"GET",dataType:"json",headers:{Authorization:"Bearer "+this.context.accessToken,"Content-Type":"application/json"}};t.success=e.success||_utils.emptyfn,t.error=e.error||_utils.emptyfn,WebIM.utils.ajax(t)},connection.prototype.dissolveGroup=function(e){var t=e.groupId,o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"?version=v3",type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.context.accessToken,"Content-Type":"application/json"}};o.success=e.success||_utils.emptyfn,o.error=e.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.getBlacklist=function(e){e=e||{};var t=_strophe.default.$iq({type:"get"}),o=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,r=this;t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),this.context.stropheConn.sendIQ(t.tree(),function(e){r.onBlacklistUpdate(_parsePrivacy(e)),o()},function(){r.onBlacklistUpdate([]),n()})},connection.prototype.addToBlackList=function(e){for(var t=_strophe.default.$iq({type:"set"}),o=e.list||{},n=e.success||_utils.emptyfn,r=e.error||_utils.emptyfn,i=t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),s=Object.keys(o),a=s.length,c=2,p=0;p<a;p++){var u=o[s[p]],l=u.type||"jid",d=u.jid;i=i.c("item",{action:"deny",order:c++,type:l,value:d}).c("message"),p!==a-1&&(i=i.up().up())}this.context.stropheConn.sendIQ(i.tree(),n,r)},connection.prototype.removeFromBlackList=function(e){for(var t=_strophe.default.$iq({type:"set"}),o=e.list||{},n=e.success||_utils.emptyfn,r=e.error||_utils.emptyfn,i=t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),s=Object.keys(o),a=s.length,c=0;c<a;c++){var p=o[s[c]],u=p.type||"jid",l=p.jid,d=p.order;i=i.c("item",{action:"deny",order:d,type:u,value:l}).c("message"),c!==a-1&&(i=i.up().up())}this.context.stropheConn.sendIQ(i.tree(),n,r)},connection.prototype._getGroupJid=function(e){return(this.context.appKey||"")+"_"+e+"@conference."+this.domain},connection.prototype.addToGroupBlackList=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n=_getJid(e,this),r=this._getGroupJid(e.roomId),i=_strophe.default.$iq({type:"set",to:r});i.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"outcast",jid:n}),this.context.stropheConn.sendIQ(i.tree(),t,o)},connection.prototype.getGroupBlacklist=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n=this._getGroupJid(e.roomId),r=_strophe.default.$iq({type:"get",to:n});r.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"outcast"}),this.context.stropheConn.sendIQ(r.tree(),function(e){t(function(e){var t={},o=e.getElementsByTagName("item");if(o)for(var n=0;n<o.length;n++){var r=o[n],i=r.getAttribute("jid"),s=r.getAttribute("affiliation"),a=r.getAttribute("nick");if(i){var c=_parseNameFromJidFn(i);t[c]={jid:i,affiliation:s,nick:a,name:c}}}return t}(e))},function(){o()})},connection.prototype.removeGroupMemberFromBlacklist=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n=_getJid(e,this),r=this._getGroupJid(e.roomId),i=_strophe.default.$iq({type:"set",to:r});i.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"member",jid:n}),this.context.stropheConn.sendIQ(i.tree(),function(e){t()},function(){o()})},connection.prototype.changeGroupSubject=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n=this._getGroupJid(e.roomId),r=_strophe.default.$iq({type:"set",to:n});r.c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).c("x",{type:"submit",xmlns:"jabber:x:data"}).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up().c("field",{var:"muc#roomconfig_roomname"}).c("value").t(e.subject).up().up().c("field",{var:"muc#roomconfig_roomdesc"}).c("value").t(e.description),this.context.stropheConn.sendIQ(r.tree(),function(e){t()},function(){o()})},connection.prototype.destroyGroup=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n=this._getGroupJid(e.roomId),r=_strophe.default.$iq({type:"set",to:n});r.c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).c("destroy"),this.context.stropheConn.sendIQ(r.tree(),function(e){t()},function(){o()})},connection.prototype.leaveGroupBySelf=function(e){var t=this,o=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,r=_getJid(e,this),i=this._getGroupJid(e.roomId),s=_strophe.default.$iq({type:"set",to:i});s.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"none",jid:r}),this.context.stropheConn.sendIQ(s.tree(),function(e){o(e);var n=_strophe.default.$pres({type:"unavailable",to:i+"/"+t.context.userId});t.sendCommand(n.tree())},function(e){n(e)})},connection.prototype.addGroupMembers=function(e){for(var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n=e.list||[],r=this._getGroupJid(e.roomId),i=_strophe.default.$iq({type:"set",to:r}),s=i.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}),a=n.length,c=0;c<a;c++){var p=_getJidByName(n[c],this);s=s.c("item",{affiliation:"member",jid:p}).up();var u=_strophe.default.$msg({to:r}).c("x",{xmlns:"http://jabber.org/protocol/muc#user"}).c("invite",{to:p}).c("reason").t(e.reason||"");this.sendCommand(u.tree())}this.context.stropheConn.sendIQ(i.tree(),function(e){t(e)},function(e){o(e)})},connection.prototype.acceptInviteFromGroup=function(e){e.success=function(){},this.addGroupMembers(e)},connection.prototype.rejectInviteFromGroup=function(e){},WebIM.connection=connection,WebIM.utils=_utils,WebIM.statusCode=_code,WebIM.message=_msg.message,WebIM.doQuery=function(e,t,o){void 0!==window.cefQuery&&window.cefQuery({request:e,persistent:!1,onSuccess:t,onFailure:o})},module.exports=WebIM,module.hot&&module.hot.accept();
},{"./libs/strophe":"MgtB","./libs/xmldom/dom-parser":"A2Tl","./status":"63GH","./utils":"FO+Z","./message":"L7ge","./queue":"E1IZ"}]},{},["DXTH"], null)
//# sourceMappingURL=/connection.js.map